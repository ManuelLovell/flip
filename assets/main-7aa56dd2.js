(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var Z=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class vo{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return Z(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return Z(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return Z(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return Z(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return Z(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return Z(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return Z(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return Z(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:i}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return i.indexOf(e)>-1})}getConnectionId(){return Z(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=i=>{e(i.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var de=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Eo{constructor(e){this.messageBus=e}reset(){return de(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return de(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return de(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return de(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return de(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return de(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return de(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function mo(t){return typeof t.id=="string"}var Rn={exports:{}},et=typeof Reflect=="object"?Reflect:null,Fn=et&&typeof et.apply=="function"?et.apply:function(e,n,i){return Function.prototype.apply.call(e,n,i)},kt;et&&typeof et.ownKeys=="function"?kt=et.ownKeys:Object.getOwnPropertySymbols?kt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:kt=function(e){return Object.getOwnPropertyNames(e)};function yo(t){console&&console.warn&&console.warn(t)}var Ni=Number.isNaN||function(e){return e!==e};function N(){N.init.call(this)}Rn.exports=N;Rn.exports.once=To;N.EventEmitter=N;N.prototype._events=void 0;N.prototype._eventsCount=0;N.prototype._maxListeners=void 0;var Xn=10;function Kt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return Xn},set:function(t){if(typeof t!="number"||t<0||Ni(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Xn=t}});N.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};N.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ni(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Si(t){return t._maxListeners===void 0?N.defaultMaxListeners:t._maxListeners}N.prototype.getMaxListeners=function(){return Si(this)};N.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var o=e==="error",s=this._events;if(s!==void 0)o=o&&s.error===void 0;else if(!o)return!1;if(o){var r;if(n.length>0&&(r=n[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")Fn(u,this,n);else for(var d=u.length,a=Pi(u,d),i=0;i<d;++i)Fn(a[i],this,n);return!0};function Li(t,e,n,i){var o,s,r;if(Kt(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),r=s[e]),r===void 0)r=s[e]=n,++t._eventsCount;else if(typeof r=="function"?r=s[e]=i?[n,r]:[r,n]:i?r.unshift(n):r.push(n),o=Si(t),o>0&&r.length>o&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=r.length,yo(c)}return t}N.prototype.addListener=function(e,n){return Li(this,e,n,!1)};N.prototype.on=N.prototype.addListener;N.prototype.prependListener=function(e,n){return Li(this,e,n,!0)};function go(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Mi(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=go.bind(i);return o.listener=n,i.wrapFn=o,o}N.prototype.once=function(e,n){return Kt(n),this.on(e,Mi(this,e,n)),this};N.prototype.prependOnceListener=function(e,n){return Kt(n),this.prependListener(e,Mi(this,e,n)),this};N.prototype.removeListener=function(e,n){var i,o,s,r,c;if(Kt(n),o=this._events,o===void 0)return this;if(i=o[e],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,i.listener||n));else if(typeof i!="function"){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===n||i[r].listener===n){c=i[r].listener,s=r;break}if(s<0)return this;s===0?i.shift():Oo(i,s),i.length===1&&(o[e]=i[0]),o.removeListener!==void 0&&this.emit("removeListener",e,c||n)}return this};N.prototype.off=N.prototype.removeListener;N.prototype.removeAllListeners=function(e){var n,i,o;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),r;for(o=0;o<s.length;++o)r=s[o],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(e,n[o]);return this};function Di(t,e,n){var i=t._events;if(i===void 0)return[];var o=i[e];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?Ao(o):Pi(o,o.length)}N.prototype.listeners=function(e){return Di(this,e,!0)};N.prototype.rawListeners=function(e){return Di(this,e,!1)};N.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):xi.call(t,e)};N.prototype.listenerCount=xi;function xi(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}N.prototype.eventNames=function(){return this._eventsCount>0?kt(this._events):[]};function Pi(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function Oo(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ao(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function To(t,e){return new Promise(function(n,i){function o(r){t.removeListener(e,s),i(r)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",o),n([].slice.call(arguments))}Hi(t,e,s,{once:!0}),e!=="error"&&_o(t,o,{once:!0})})}function _o(t,e,n){typeof t.on=="function"&&Hi(t,"error",e,n)}function Hi(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(s){i.once&&t.removeEventListener(e,o),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Ro=Rn.exports;let Pt;const Io=new Uint8Array(16);function wo(){if(!Pt&&(Pt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pt(Io)}const k=[];for(let t=0;t<256;++t)k.push((t+256).toString(16).slice(1));function bo(t,e=0){return k[t[e+0]]+k[t[e+1]]+k[t[e+2]]+k[t[e+3]]+"-"+k[t[e+4]]+k[t[e+5]]+"-"+k[t[e+6]]+k[t[e+7]]+"-"+k[t[e+8]]+k[t[e+9]]+"-"+k[t[e+10]]+k[t[e+11]]+k[t[e+12]]+k[t[e+13]]+k[t[e+14]]+k[t[e+15]]}const Co=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zn={randomUUID:Co};function Bo(t,e,n){if(Zn.randomUUID&&!e&&!t)return Zn.randomUUID();t=t||{};const i=t.random||(t.rng||wo)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){n=n||0;for(let o=0;o<16;++o)e[n+o]=i[o];return e}return bo(i)}class No extends Ro.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=i=>{const o=i.data;if(i.origin===this.targetOrigin&&mo(o)){if(o.id==="OBR_READY"){this.ready=!0;const s=o.data;this.ref=s.ref,this.userId=s.userId}this.emit(o.id,o.data)}},this.send=(i,o,s)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:i,data:o,ref:this.ref,nonce:s},this.targetOrigin)},this.sendAsync=(i,o,s=5e3)=>{const r=`_${Bo()}`;return this.send(i,o,r),Promise.race([new Promise((c,u)=>{const d=this;function a(v){d.off(`${i}_RESPONSE${r}`,a),d.off(`${i}_ERROR${r}`,f),c(v)}function f(v){d.off(`${i}_RESPONSE${r}`,a),d.off(`${i}_ERROR${r}`,f),u(v)}this.on(`${i}_RESPONSE${r}`,a),this.on(`${i}_ERROR${r}`,f)}),new Promise((c,u)=>window.setTimeout(()=>u(new Error(`Message ${i} took longer than ${s}ms to get a result`)),s))])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Kn=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class So{constructor(e){this.messageBus=e}show(e,n){return Kn(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return i})}close(e){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var Ke=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Lo{constructor(e){this.messageBus=e}getColor(){return Ke(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return Ke(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return Ke(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=i=>{e(i.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var K=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Mo{constructor(e){this.messageBus=e}getDpi(){return K(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return K(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return K(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return K(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return K(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return K(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return K(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,i,o){return K(this,void 0,void 0,function*(){const{position:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:i,useCenter:o});return s})}getDistance(e,n){return K(this,void 0,void 0,function*(){const{distance:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return i})}onChange(e){const n=i=>{e(i.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Ht=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Do{constructor(e){this.messageBus=e}undo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Ht(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Ht(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function F(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Ve(t){return!!t&&!!t[ne]}function Ne(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var i=Object.getPrototypeOf(n);if(i===null)return!0;var o=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===Vo}(t)||Array.isArray(t)||!!t[ht]||!!(!((e=t.constructor)===null||e===void 0)&&e[ht])||zt(t)||qt(t))}function tt(t,e,n){n===void 0&&(n=!1),Se(t)===0?(n?Object.keys:Sn)(t).forEach(function(i){n&&typeof i=="symbol"||e(i,t[i],t)}):t.forEach(function(i,o){return e(o,i,t)})}function Se(t){var e=t[ne];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:zt(t)?2:qt(t)?3:0}function yt(t,e){return Se(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Vt(t,e){return Se(t)===2?t.get(e):t[e]}function Gi(t,e,n){var i=Se(t);i===2?t.set(e,n):i===3?t.add(n):t[e]=n}function xo(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function zt(t){return Uo&&t instanceof Map}function qt(t){return ko&&t instanceof Set}function He(t){return t.o||t.t}function In(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=$o(t);delete e[ne];for(var n=Sn(e),i=0;i<n.length;i++){var o=n[i],s=e[o];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[o]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),e)}function wn(t,e){return e===void 0&&(e=!1),bn(t)||Ve(t)||!Ne(t)||(Se(t)>1&&(t.set=t.add=t.clear=t.delete=Po),Object.freeze(t),e&&tt(t,function(n,i){return wn(i,!0)},!0)),t}function Po(){F(2)}function bn(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function ge(t){var e=mn[t];return e||F(18,t),e}function Ho(t,e){mn[t]||(mn[t]=e)}function zn(){return gt}function nn(t,e){e&&(ge("Patches"),t.u=[],t.s=[],t.v=e)}function jt(t){pn(t),t.p.forEach(Go),t.p=null}function pn(t){t===gt&&(gt=t.l)}function qn(t){return gt={p:[],l:gt,h:t,m:!0,_:0}}function Go(t){var e=t[ne];e.i===0||e.i===1?e.j():e.g=!0}function on(t,e){e._=e.p.length;var n=e.p[0],i=t!==void 0&&t!==n;return e.h.O||ge("ES5").S(e,t,i),i?(n[ne].P&&(jt(e),F(4)),Ne(t)&&(t=Wt(e,t),e.l||Ft(e,t)),e.u&&ge("Patches").M(n[ne].t,t,e.u,e.s)):t=Wt(e,n,[]),jt(e),e.u&&e.v(e.u,e.s),t!==Nn?t:void 0}function Wt(t,e,n){if(bn(e))return e;var i=e[ne];if(!i)return tt(e,function(c,u){return Jn(t,i,e,c,u,n)},!0),e;if(i.A!==t)return e;if(!i.P)return Ft(t,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var o=i.i===4||i.i===5?i.o=In(i.k):i.o,s=o,r=!1;i.i===3&&(s=new Set(o),o.clear(),r=!0),tt(s,function(c,u){return Jn(t,i,o,c,u,n,r)}),Ft(t,o,!1),n&&t.u&&ge("Patches").N(i,n,t.u,t.s)}return i.o}function Jn(t,e,n,i,o,s,r){if(Ve(o)){var c=Wt(t,o,s&&e&&e.i!==3&&!yt(e.R,i)?s.concat(i):void 0);if(Gi(n,i,c),!Ve(c))return;t.m=!1}else r&&n.add(o);if(Ne(o)&&!bn(o)){if(!t.h.D&&t._<1)return;Wt(t,o),e&&e.A.l||Ft(t,o)}}function Ft(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&wn(e,n)}function sn(t,e){var n=t[ne];return(n?He(n):t)[e]}function Qn(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=Object.getPrototypeOf(n)}}function vn(t){t.P||(t.P=!0,t.l&&vn(t.l))}function rn(t){t.o||(t.o=In(t.t))}function En(t,e,n){var i=zt(e)?ge("MapSet").F(e,n):qt(e)?ge("MapSet").T(e,n):t.O?function(o,s){var r=Array.isArray(o),c={i:r?1:0,A:s?s.A:zn(),P:!1,I:!1,R:{},l:s,t:o,k:null,o:null,j:null,C:!1},u=c,d=yn;r&&(u=[c],d=ft);var a=Proxy.revocable(u,d),f=a.revoke,v=a.proxy;return c.k=v,c.j=f,v}(e,n):ge("ES5").J(e,n);return(n?n.A:zn()).p.push(i),i}function Yo(t){return Ve(t)||F(22,t),function e(n){if(!Ne(n))return n;var i,o=n[ne],s=Se(n);if(o){if(!o.P&&(o.i<4||!ge("ES5").K(o)))return o.t;o.I=!0,i=ei(n,s),o.I=!1}else i=ei(n,s);return tt(i,function(r,c){o&&Vt(o.t,r)===c||Gi(i,r,e(c))}),s===3?new Set(i):i}(t)}function ei(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return In(t)}function Cn(){function t(i){if(!Ne(i))return i;if(Array.isArray(i))return i.map(t);if(zt(i))return new Map(Array.from(i.entries()).map(function(r){return[r[0],t(r[1])]}));if(qt(i))return new Set(Array.from(i).map(t));var o=Object.create(Object.getPrototypeOf(i));for(var s in i)o[s]=t(i[s]);return yt(i,ht)&&(o[ht]=i[ht]),o}function e(i){return Ve(i)?t(i):i}var n="add";Ho("Patches",{$:function(i,o){return o.forEach(function(s){for(var r=s.path,c=s.op,u=i,d=0;d<r.length-1;d++){var a=Se(u),f=r[d];typeof f!="string"&&typeof f!="number"&&(f=""+f),a!==0&&a!==1||f!=="__proto__"&&f!=="constructor"||F(24),typeof u=="function"&&f==="prototype"&&F(24),typeof(u=Vt(u,f))!="object"&&F(15,r.join("/"))}var v=Se(u),p=t(s.value),E=r[r.length-1];switch(c){case"replace":switch(v){case 2:return u.set(E,p);case 3:F(16);default:return u[E]=p}case n:switch(v){case 1:return E==="-"?u.push(p):u.splice(E,0,p);case 2:return u.set(E,p);case 3:return u.add(p);default:return u[E]=p}case"remove":switch(v){case 1:return u.splice(E,1);case 2:return u.delete(E);case 3:return u.delete(s.value);default:return delete u[E]}default:F(17,c)}}),i},N:function(i,o,s,r){switch(i.i){case 0:case 4:case 2:return function(c,u,d,a){var f=c.t,v=c.o;tt(c.R,function(p,E){var m=Vt(f,p),A=Vt(v,p),T=E?yt(f,p)?"replace":n:"remove";if(m!==A||T!=="replace"){var I=u.concat(p);d.push(T==="remove"?{op:T,path:I}:{op:T,path:I,value:A}),a.push(T===n?{op:"remove",path:I}:T==="remove"?{op:n,path:I,value:e(m)}:{op:"replace",path:I,value:e(m)})}})}(i,o,s,r);case 5:case 1:return function(c,u,d,a){var f=c.t,v=c.R,p=c.o;if(p.length<f.length){var E=[p,f];f=E[0],p=E[1];var m=[a,d];d=m[0],a=m[1]}for(var A=0;A<f.length;A++)if(v[A]&&p[A]!==f[A]){var T=u.concat([A]);d.push({op:"replace",path:T,value:e(p[A])}),a.push({op:"replace",path:T,value:e(f[A])})}for(var I=f.length;I<p.length;I++){var b=u.concat([I]);d.push({op:n,path:b,value:e(p[I])})}f.length<p.length&&a.push({op:"replace",path:u.concat(["length"]),value:f.length})}(i,o,s,r);case 3:return function(c,u,d,a){var f=c.t,v=c.o,p=0;f.forEach(function(E){if(!v.has(E)){var m=u.concat([p]);d.push({op:"remove",path:m,value:E}),a.unshift({op:n,path:m,value:E})}p++}),p=0,v.forEach(function(E){if(!f.has(E)){var m=u.concat([p]);d.push({op:n,path:m,value:E}),a.unshift({op:"remove",path:m,value:E})}p++})}(i,o,s,r)}},M:function(i,o,s,r){s.push({op:"replace",path:[],value:o===Nn?void 0:o}),r.push({op:"replace",path:[],value:i})}})}var ti,gt,Bn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Uo=typeof Map<"u",ko=typeof Set<"u",ni=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Nn=Bn?Symbol.for("immer-nothing"):((ti={})["immer-nothing"]=!0,ti),ht=Bn?Symbol.for("immer-draftable"):"__$immer_draftable",ne=Bn?Symbol.for("immer-state"):"__$immer_state",Vo=""+Object.prototype.constructor,Sn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,$o=Object.getOwnPropertyDescriptors||function(t){var e={};return Sn(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},mn={},yn={get:function(t,e){if(e===ne)return t;var n=He(t);if(!yt(n,e))return function(o,s,r){var c,u=Qn(s,r);return u?"value"in u?u.value:(c=u.get)===null||c===void 0?void 0:c.call(o.k):void 0}(t,n,e);var i=n[e];return t.I||!Ne(i)?i:i===sn(t.t,e)?(rn(t),t.o[e]=En(t.A.h,i,t)):i},has:function(t,e){return e in He(t)},ownKeys:function(t){return Reflect.ownKeys(He(t))},set:function(t,e,n){var i=Qn(He(t),e);if(i?.set)return i.set.call(t.k,n),!0;if(!t.P){var o=sn(He(t),e),s=o?.[ne];if(s&&s.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(xo(n,o)&&(n!==void 0||yt(t.t,e)))return!0;rn(t),vn(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return sn(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,rn(t),vn(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=He(t),i=Reflect.getOwnPropertyDescriptor(n,e);return i&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:i.enumerable,value:n[e]}},defineProperty:function(){F(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){F(12)}},ft={};tt(yn,function(t,e){ft[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),ft.deleteProperty=function(t,e){return ft.set.call(this,t,e,void 0)},ft.set=function(t,e,n){return yn.set.call(this,t[0],e,n,t[0])};var jo=function(){function t(n){var i=this;this.O=ni,this.D=!0,this.produce=function(o,s,r){if(typeof o=="function"&&typeof s!="function"){var c=s;s=o;var u=i;return function(m){var A=this;m===void 0&&(m=c);for(var T=arguments.length,I=Array(T>1?T-1:0),b=1;b<T;b++)I[b-1]=arguments[b];return u.produce(m,function(l){var w;return(w=s).call.apply(w,[A,l].concat(I))})}}var d;if(typeof s!="function"&&F(6),r!==void 0&&typeof r!="function"&&F(7),Ne(o)){var a=qn(i),f=En(i,o,void 0),v=!0;try{d=s(f),v=!1}finally{v?jt(a):pn(a)}return typeof Promise<"u"&&d instanceof Promise?d.then(function(m){return nn(a,r),on(m,a)},function(m){throw jt(a),m}):(nn(a,r),on(d,a))}if(!o||typeof o!="object"){if((d=s(o))===void 0&&(d=o),d===Nn&&(d=void 0),i.D&&wn(d,!0),r){var p=[],E=[];ge("Patches").M(o,d,p,E),r(p,E)}return d}F(21,o)},this.produceWithPatches=function(o,s){if(typeof o=="function")return function(d){for(var a=arguments.length,f=Array(a>1?a-1:0),v=1;v<a;v++)f[v-1]=arguments[v];return i.produceWithPatches(d,function(p){return o.apply(void 0,[p].concat(f))})};var r,c,u=i.produce(o,s,function(d,a){r=d,c=a});return typeof Promise<"u"&&u instanceof Promise?u.then(function(d){return[d,r,c]}):[u,r,c]},typeof n?.useProxies=="boolean"&&this.setUseProxies(n.useProxies),typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Ne(n)||F(8),Ve(n)&&(n=Yo(n));var i=qn(this),o=En(this,n,void 0);return o[ne].C=!0,pn(i),o},e.finishDraft=function(n,i){var o=n&&n[ne],s=o.A;return nn(s,i),on(void 0,s)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!ni&&F(20),this.O=n},e.applyPatches=function(n,i){var o;for(o=i.length-1;o>=0;o--){var s=i[o];if(s.path.length===0&&s.op==="replace"){n=s.value;break}}o>-1&&(i=i.slice(o+1));var r=ge("Patches").$;return Ve(n)?r(n,i):this.produce(n,function(c){return r(c,i)})},t}(),ie=new jo;ie.produce;var Ln=ie.produceWithPatches.bind(ie);ie.setAutoFreeze.bind(ie);ie.setUseProxies.bind(ie);ie.applyPatches.bind(ie);ie.createDraft.bind(ie);ie.finishDraft.bind(ie);var ze=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};Cn();class Wo{constructor(e){this.messageBus=e}getItems(e){return ze(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,i=!0){return ze(this,void 0,void 0,function*(){let o;this.isItemArray(e)?o=e:o=yield this.getItems(e);const[s,r]=Ln(o,n),c=s.map(u=>({id:u.id,type:u.type}));for(const u of r){const[d,a]=u.path;typeof d=="number"&&typeof a=="string"&&(c[d][a]=s[d][a])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:c,updateAttachments:i})})}addItems(e){return ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ze(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return ze(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var qe=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};Cn();class Fo{constructor(e){this.messageBus=e}getItems(e){return qe(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,i,o=!0){return qe(this,void 0,void 0,function*(){const s=yield this.getItems(e),[r,c]=Ln(s,n),u=r.map(d=>({id:d.id,type:d.type}));for(const d of c){const[a,f]=d.path;typeof a=="number"&&typeof f=="string"&&(u[a][f]=r[a][f])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:u,fastUpdate:i,updateAttachments:o})})}addItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return qe(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return qe(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var an=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Xo{constructor(e){this.messageBus=e,this.grid=new Mo(e),this.fog=new Lo(e),this.history=new Do(e),this.items=new Wo(e),this.local=new Fo(e)}isReady(){return an(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=i=>{e(i.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return an(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return an(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=i=>{e(i.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Yi(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function pt(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Yi(e.icon)}))}function Mn(t){return Object.assign(Object.assign({},t),{url:Yi(t.url)})}var ii=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Zo{constructor(e){this.contextMenus={},this.handleClick=n=>{var i;const o=this.contextMenus[n.id];o&&((i=o.onClick)===null||i===void 0||i.call(o,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return ii(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),embed:e.embed&&Mn(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return ii(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var ve=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ko{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const i=this.tools[n.id];if(i)if(i.onClick){const o=i.onClick(n.context,n.elementId);Promise.resolve(o).then(s=>{s&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var i;const o=this.toolActions[n.id];o&&((i=o.onClick)===null||i===void 0||i.call(o,n.context,n.elementId))},this.handleToolModeClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onClick){const o=i.onClick(n.context,n.elementId);Promise.resolve(o).then(s=>{s&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onToolClick){const o=i.onToolClick(n.context,n.event);Promise.resolve(o).then(s=>{s&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onToolDoubleClick){const o=i.onToolDoubleClick(n.context,n.event);Promise.resolve(o).then(s=>{s&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolDown)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolMove=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolMove)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolUp=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolUp)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolDragStart)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolDragMove)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolDragEnd)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onToolDragCancel)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeKeyDown=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onKeyDown)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeKeyUp=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onKeyUp)===null||i===void 0||i.call(o,n.context,n.event))},this.handleToolModeActivate=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onActivate)===null||i===void 0||i.call(o,n.context))},this.handleToolModeDeactivate=n=>{var i;const o=this.toolModes[n.id];o&&((i=o.onDeactivate)===null||i===void 0||i.call(o,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:pt(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return ve(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var Je=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class zo{constructor(e){this.messageBus=e}open(e){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Mn(e)))})}close(e){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return Je(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return Je(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var oi=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class qo{constructor(e){this.messageBus=e}open(e){return oi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Mn(e)))})}close(e){return oi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var z=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Jo{constructor(e){this.messageBus=e}getWidth(){return z(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return z(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return z(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return z(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return z(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return z(this,void 0,void 0,function*(){const n=pt([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return z(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return z(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=i=>{e(i.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Qo=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};Cn();class es{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Qo(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let o=e;return[c=>{const[u,d]=Ln(o,c);return o=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:i,patches:d}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:i})}]})}}var ts=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class ns{constructor(e){this.messageBus=e}getPlayers(){return ts(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=i=>{e(i.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var cn=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class is{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return cn(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return cn(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=i=>{e(i.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=i=>{e(i.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var os=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class ss{constructor(e){this.messageBus=e}getTheme(){return os(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=i=>{e(i.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var si=globalThis&&globalThis.__awaiter||function(t,e,n,i){function o(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function c(a){try{d(i.next(a))}catch(f){r(f)}}function u(a){try{d(i.throw(a))}catch(f){r(f)}}function d(a){a.done?s(a.value):o(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class rs{constructor(e){this.messageBus=e}uploadImages(e){return si(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e})})}uploadScenes(e){return si(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e})})}}const as=typeof atob=="function",Dn=typeof Buffer=="function",ri=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",us=Array.prototype.slice.call(cs),Gt=(t=>{let e={};return t.forEach((n,i)=>e[n]=i),e})(us),ds=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ye=String.fromCharCode.bind(String),ai=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ui=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),ls=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,fs=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Ye((n>>>10)+55296)+Ye((n&1023)+56320);case 3:return Ye((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Ye((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},hs=t=>t.replace(ls,fs),ps=t=>{if(t=t.replace(/\s+/g,""),!ds.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",i,o;for(let s=0;s<t.length;)e=Gt[t.charAt(s++)]<<18|Gt[t.charAt(s++)]<<12|(i=Gt[t.charAt(s++)])<<6|(o=Gt[t.charAt(s++)]),n+=i===64?Ye(e>>16&255):o===64?Ye(e>>16&255,e>>8&255):Ye(e>>16&255,e>>8&255,e&255);return n},ki=as?t=>atob(Ui(t)):Dn?t=>Buffer.from(t,"base64").toString("binary"):ps,vs=Dn?t=>ai(Buffer.from(t,"base64")):t=>ai(ki(t).split("").map(e=>e.charCodeAt(0))),Es=Dn?t=>Buffer.from(t,"base64").toString("utf8"):ri?t=>ri.decode(vs(t)):t=>hs(ki(t)),ms=t=>Ui(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),ys=t=>Es(ms(t));function gs(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",i="";if(e){const s=ys(e).split(" ");s.length===2&&(n=s[0],i=s[1])}return{origin:n,roomId:i}}var ci;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(ci||(ci={}));const gn=gs(),$=new No(gn.origin,gn.roomId),Os=new Eo($),As=new vo($),Ts=new ns($),_s=new So($),Rs=new Xo($),Is=new Zo($),ws=new Ko($),bs=new zo($),Cs=new qo($),Bs=new Jo($),Ns=new es($),Ss=new is($),Ls=new ss($),Ms=new rs($),_={onReady:t=>{$.ready?t():$.once("OBR_READY",()=>t())},get isReady(){return $.ready},viewport:Os,player:As,party:Ts,notification:_s,scene:Rs,contextMenu:Is,tool:ws,popover:bs,modal:Cs,action:Bs,interaction:Ns,room:Ss,theme:Ls,assets:Ms,isAvailable:!!gn.origin};function Ee(t){return`<label class="switch" id="setting${t}Container">
        <span class="slider round"></span>
        </label>`}function me(t,e){const n=document.getElementById(`setting${t}Container`),i=document.createElement("input");i.type="checkbox",i.value=String(e),i.checked=e,i.onclick=async function(s){const r=s.target;switch(i.value=String(r.checked),t){case y.DISABLEBIND:await _.room.setMetadata({[te.DISABLEBIND]:r.checked});break;case y.KEEPATTACH:await _.room.setMetadata({[te.KEEPATTACH]:r.checked});break;case y.MAPLAYER:await o(y.MAPLAYER,r.checked);break;case y.DRAWINGLAYER:await o(y.DRAWINGLAYER,r.checked);break;case y.PROPLAYER:await o(y.PROPLAYER,r.checked);break;case y.MOUNTLAYER:await o(y.MOUNTLAYER,r.checked);break;case y.CHARACTERLAYER:await o(y.CHARACTERLAYER,r.checked);break;case y.ATTACHLAYER:await o(y.ATTACHLAYER,r.checked);break;case y.NOTELAYER:await o(y.NOTELAYER,r.checked);break;case y.TEXTLAYER:await o(y.TEXTLAYER,r.checked);break}},n?.insertBefore(i,n.firstChild);async function o(s,r){const c=r?V.ZLAYERING+=s:V.ZLAYERING.split(s).join("");await _.room.setMetadata({[te.ZINDEXES]:c})}}class y{static MAPLAYER="M";static GRIDLAYER="G";static DRAWINGLAYER="D";static PROPLAYER="P";static MOUNTLAYER="H";static CHARACTERLAYER="C";static ATTACHLAYER="A";static NOTELAYER="N";static TEXTLAYER="T";static DISABLEBIND="NOBIND";static KEEPATTACH="KEEPATTACH"}class S{static EXTENSIONID="com.battle-system.flip";static VERSION="whatsnew-flip-201";static CONTEXTFLIPID="com.battle-system.flip-menu/context-menu-flipit";static CONTEXTFLOPID="com.battle-system.flip-menu/context-menu-flopit";static CONTEXTBINDID="com.battle-system.flip-menu/context-menu-bindit";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static CHECKREGISTRATION="https://vrwtdtmnbyhaehtitrlb.supabase.co/functions/v1/patreon-check";static MAINHTML=`
    <div class="container">
        <table>
            <thead>
                <tr class="head-title">
                    <th>Flip!</th>
                    <th></th>
                    <th></th>
                    <th><div id="patreonContainer"></div></th>
                </tr>
            </thead>
            <tbody>
                <tr id="tip_removebind">
                    <td colspan ="3">Disable Player Bind</td>
                    <td>${Ee(y.DISABLEBIND)}</td>
                </tr>
                <tr id="tip_attachparent">
                    <td colspan ="3">Attachments with Parent</td>
                    <td>${Ee(y.KEEPATTACH)}</td>
                </tr>
                <tr id="tip_zindex">
                    <td class="title" colspan ="4">Z-Indexing Layers</td>
                </tr>
                <tr>
                    <td>Map</td>
                    <td>${Ee(y.MAPLAYER)}</td>
                    <td>Prop</td>
                    <td>${Ee(y.PROPLAYER)}</td>
                </tr>
                <tr>
                    <td>Character</td>
                    <td>${Ee(y.CHARACTERLAYER)}</td>
                    <td>Mount</td>
                    <td>${Ee(y.MOUNTLAYER)}</td>
                </tr>
                <tr>
                    <td>Attachment</td>
                    <td>${Ee(y.ATTACHLAYER)}</td>
                    <td>Note</td>
                    <td>${Ee(y.NOTELAYER)}</td>
                </tr>
                <tr>
                    <td>Drawing</td>
                    <td>${Ee(y.DRAWINGLAYER)}</td>
                    <td>Text</td>
                    <td>${Ee(y.TEXTLAYER)}</td>
                </tr>
            </tbody>
        </table>
    </div>`}class te{static DISABLEBIND=`${S.EXTENSIONID}/disableBinding`;static KEEPATTACH=`${S.EXTENSIONID}/attachmentParent`;static ZINDEXES=`${S.EXTENSIONID}/zLayering`}async function xn(){V.playerRole==="PLAYER"&&Ue(te.DISABLEBIND)||await _.contextMenu.create({id:S.CONTEXTFLOPID,icons:[{icon:"/flop.svg",label:"Flip It!",filter:{every:[{key:["metadata",`${S.EXTENSIONID}/metadata_bind`],value:void 0,operator:"!=",coordinator:"&&"},{key:"image",value:void 0,operator:"!=",coordinator:"&&"},{key:"layer",value:"GRID",operator:"!=",coordinator:"&&"},{key:"layer",value:"RULER",operator:"!=",coordinator:"&&"},{key:"layer",value:"FOG",operator:"!=",coordinator:"&&"},{key:"layer",value:"POINTER",operator:"!=",coordinator:"&&"},{key:"layer",value:"CONTROL",operator:"!=",coordinator:"&&"},{key:"layer",value:"POPOVER",operator:"!=",coordinator:"&&"}]}}],async onClick(t,e){let n=[],i=[],o=[],s=[];await _.player.deselect(t.items.map(a=>a.id));const c=(await _.scene.items.getItemAttachments(t.items.map(a=>a.id))).filter(a=>!t.items.find(f=>f.id==a.id)),u=(await _.scene.items.getItems()).map(a=>a.id);for(let a of t.items){const f=a,v=JSON.parse(f.metadata[`${S.EXTENSIONID}/metadata_bind`]),E=u.includes(v.id)?un():void 0;if(E&&(v.id=E),V.KEEPATTACHMENTS){const m=(await _.scene.items.getItemAttachments([a.id]))?.filter(T=>T.id!==a.id);m?.length>0?(a.metadata[`${S.EXTENSIONID}/metadata_bind_attachments`]=JSON.stringify(m),o=o.concat(m)):a.metadata[`${S.EXTENSIONID}/metadata_bind_attachments`]=void 0;const A=v.metadata[`${S.EXTENSIONID}/metadata_bind_attachments`];if(A){const T=f.position.x-v.position.x,I=f.position.y-v.position.y,b=JSON.parse(A);for(const l of b)l.position.x+=T,l.position.y+=I,E&&(l.id=un(),l.attachedTo=E);n=n.concat(b)}}else for(let m of c)if(t.items.find(T=>T.id===m.attachedTo)){const T={...m};T.attachedTo=E||v.id,E&&(T.id=un()),s.push(T)}v.position.x=f.position.x,v.position.y=f.position.y,f.metadata[`${S.EXTENSIONID}/metadata_bind`]=void 0,v.metadata[`${S.EXTENSIONID}/metadata_bind`]=JSON.stringify(f),n.push(v),i.push(v.id),o.push(a)}await _.scene.items.addItems(n),V.KEEPATTACHMENTS||await _.scene.items.updateItems(c,a=>{for(let f of a){const v=s.find(p=>p.id===f.id);v&&(f.attachedTo=v.attachedTo)}}),await _.scene.items.deleteItems(o.map(a=>a.id));const d=i;await _.player.select(d)}})}async function Vi(){await _.contextMenu.create({id:S.CONTEXTFLIPID,icons:[{icon:"/flip.svg",label:"Reverse It",filter:{every:[{key:"image",value:void 0,operator:"!="}]}}],async onClick(t,e){await _.scene.items.updateItems(t.items,n=>{for(let i of n)i.scale.x=-i.scale.x})}})}async function Pn(){V.playerRole==="PLAYER"&&Ue(te.DISABLEBIND)||await _.contextMenu.create({id:S.CONTEXTBINDID,icons:[{icon:"/combine.svg",label:"Bind It",filter:{min:2,max:2,every:[{key:["metadata",`${S.EXTENSIONID}/metadata_bind`],value:void 0,coordinator:"&&"},{key:"image",value:void 0,operator:"!=",coordinator:"&&"},{key:"layer",value:"GRID",operator:"!=",coordinator:"&&"},{key:"layer",value:"RULER",operator:"!=",coordinator:"&&"},{key:"layer",value:"FOG",operator:"!=",coordinator:"&&"},{key:"layer",value:"POINTER",operator:"!=",coordinator:"&&"},{key:"layer",value:"CONTROL",operator:"!=",coordinator:"&&"},{key:"layer",value:"POPOVER",operator:"!=",coordinator:"&&"}]}},{icon:"/split.svg",label:"Un-Bind It",filter:{max:1,every:[{key:["metadata",`${S.EXTENSIONID}/metadata_bind`],value:void 0,operator:"!=",coordinator:"&&"},{key:"image",value:void 0,operator:"!=",coordinator:"&&"},{key:"layer",value:"GRID",operator:"!=",coordinator:"&&"},{key:"layer",value:"RULER",operator:"!=",coordinator:"&&"},{key:"layer",value:"FOG",operator:"!=",coordinator:"&&"},{key:"layer",value:"POINTER",operator:"!=",coordinator:"&&"},{key:"layer",value:"CONTROL",operator:"!=",coordinator:"&&"},{key:"layer",value:"POPOVER",operator:"!=",coordinator:"&&"}]}}],async onClick(t,e){if(t.items.length==1){const n=t.items[0],i=JSON.parse(n.metadata[`${S.EXTENSIONID}/metadata_bind`]);i.position.x=n.position.x+n.image.width/2,i.position.y=n.position.y+n.image.height/4,i.metadata[`${S.EXTENSIONID}/metadata_bind`]=void 0,await _.scene.items.updateItems(o=>o.id===n.id,o=>{for(let s of o)s.metadata[`${S.EXTENSIONID}/metadata_bind`]=void 0}),await _.scene.items.addItems([i])}else{if(!t.items.every(s=>s.layer===t.items[0].layer)){await _.notification.show("Bound items must be from the same Layer.","WARNING");return}const i=t.items[0],o=t.items[1];await _.scene.items.updateItems([t.items[0]],s=>{for(let r=0;r<s.length;r++)s[r].metadata[`${S.EXTENSIONID}/metadata_bind`]=JSON.stringify(o)}),await _.scene.items.deleteItems([o.id]),await _.player.select([i.id])}}})}class D{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static ROOMMETA="ROOMMETADATA";debouncedOnSceneItemsChange;debouncedOnSceneMetadataChange;CHARACTER_CACHE;USER_REGISTERED;LOADING;playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;gridDpi;gridScale;sceneItems;sceneSelected;sceneMetadata;sceneReady;oldRoomMetadata;roomMetadata;theme;caches;BINDINGDISABLED=!1;KEEPATTACHMENTS=!1;ZLAYERING="";ZMAPLAYER=!1;ZGRIDLAYER=!1;ZDRAWINGLAYER=!1;ZPROPLAYER=!1;ZMOUNTLAYER=!1;ZCHARLAYER=!1;ZATTACHLAYER=!1;ZNOTELAYER=!1;ZTEXTLAYER=!1;sceneMetadataHandler;sceneItemsHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.sceneItems=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.sceneReady=!1,this.theme="DARK",this.oldRoomMetadata={},this.roomMetadata={},this.LOADING=!1,this.CHARACTER_CACHE=[],this.USER_REGISTERED=!1,this.caches=e,this.debouncedOnSceneItemsChange=ui(this.OnSceneItemsChange.bind(this),100),this.debouncedOnSceneMetadataChange=ui(this.OnSceneMetadataChanges.bind(this),100)}async InitializeCache(){this.sceneReady=await _.scene.isReady(),this.theme=await _.theme.getTheme(),di(this.theme,document),this.caches.includes(D.PLAYER)&&(this.playerId=await _.player.getId(),this.playerName=await _.player.getName(),this.playerColor=await _.player.getColor(),this.playerMetadata=await _.player.getMetadata(),this.playerRole=await _.player.getRole()),this.caches.includes(D.PARTY)&&(this.party=await _.party.getPlayers()),this.caches.includes(D.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await _.scene.items.getItems()),this.caches.includes(D.SCENEMETA)&&this.sceneReady&&(this.sceneMetadata=await _.scene.getMetadata()),this.caches.includes(D.SCENEGRID)&&this.sceneReady&&(this.gridDpi=await _.scene.grid.getDpi(),this.gridScale=(await _.scene.grid.getScale()).parsed?.multiplier??5),this.caches.includes(D.ROOMMETA)&&(this.sceneReady&&(this.roomMetadata=await _.room.getMetadata()),await this.SetupSettingDefaults()),await this.CheckRegistration()}KillHandlers(){this.caches.includes(D.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(D.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(D.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(D.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(D.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(D.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(D.SCENEMETA)&&(this.sceneMetadataHandler=_.scene.onMetadataChange(async e=>{this.sceneMetadata=e,this.debouncedOnSceneMetadataChange(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(D.SCENEITEMS)&&(this.sceneItemsHandler=_.scene.items.onChange(async e=>{this.sceneItems=e,this.debouncedOnSceneItemsChange(e)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(D.SCENEGRID)&&(this.sceneGridHandler=_.scene.grid.onChange(async e=>{this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale),await this.OnSceneGridChange(e)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(D.PLAYER)&&(this.playerHandler=_.player.onChange(async e=>{this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e)})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(D.PARTY)&&(this.partyHandler=_.party.onChange(async e=>{this.party=e.filter(n=>n.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(D.ROOMMETA)&&(this.roomHandler=_.room.onMetadataChange(async e=>{this.roomMetadata=e,await this.OnRoomMetadataChange(e),this.oldRoomMetadata=e})),this.themeHandler===void 0&&(this.themeHandler=_.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=_.scene.onReadyChange(async e=>{this.sceneReady=e,e&&(this.sceneItems=await _.scene.items.getItems(),this.sceneMetadata=await _.scene.getMetadata(),this.gridDpi=await _.scene.grid.getDpi(),this.gridScale=(await _.scene.grid.getScale()).parsed?.multiplier??5),await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){}async UpdateZIndex(e){const n=[];this.ZMAPLAYER&&n.push("MAP"),this.ZGRIDLAYER&&n.push("GRID"),this.ZDRAWINGLAYER&&n.push("DRAWING"),this.ZPROPLAYER&&n.push("PROP"),this.ZMOUNTLAYER&&n.push("MOUNT"),this.ZCHARLAYER&&n.push("CHARACTER"),this.ZATTACHLAYER&&n.push("ATTACHMENT"),this.ZNOTELAYER&&n.push("NOTE"),this.ZTEXTLAYER&&n.push("TEXT"),await _.scene.items.updateItems(e,i=>{for(let o of i)if(n.includes(o.layer)){const s=o.type==="IMAGE"?o.position.y*100+o.image.height/6:o.position.y*100;(o.zIndex!==s&&o.metadata[`${S.EXTENSIONID}/metadata_flip`]!==void 0||o.metadata[`${S.EXTENSIONID}/metadata_flip`]===void 0)&&(o.metadata[`${S.EXTENSIONID}/metadata_flip`]={anchor:s},o.zIndex=s)}})}async OnSceneItemsChange(e){this.sceneReady&&await this.UpdateZIndex(e)}async OnSceneGridChange(e){}async OnSceneReadyChange(e){e&&await ao.Initialize()}async OnPlayerChange(e){}async OnPartyChange(e){}async SetupSettingDefaults(){this.BINDINGDISABLED=Ue(te.DISABLEBIND)??!1,this.KEEPATTACHMENTS=Ue(te.KEEPATTACH)??!1,this.ZLAYERING=Ue(te.ZINDEXES)??"",this.ZMAPLAYER=this.ZLAYERING.includes(y.MAPLAYER),this.ZGRIDLAYER=this.ZLAYERING.includes(y.GRIDLAYER),this.ZDRAWINGLAYER=this.ZLAYERING.includes(y.DRAWINGLAYER),this.ZPROPLAYER=this.ZLAYERING.includes(y.PROPLAYER),this.ZMOUNTLAYER=this.ZLAYERING.includes(y.MOUNTLAYER),this.ZCHARLAYER=this.ZLAYERING.includes(y.CHARACTERLAYER),this.ZATTACHLAYER=this.ZLAYERING.includes(y.ATTACHLAYER),this.ZNOTELAYER=this.ZLAYERING.includes(y.NOTELAYER),this.ZTEXTLAYER=this.ZLAYERING.includes(y.TEXTLAYER),this.roomMetadata[te.DISABLEBIND]!==this.oldRoomMetadata[te.DISABLEBIND]&&this.playerRole==="PLAYER"&&(this.BINDINGDISABLED?(await _.contextMenu.remove(S.CONTEXTBINDID),await _.contextMenu.remove(S.CONTEXTFLOPID)):await Pn(),await xn())}async OnRoomMetadataChange(e){await this.SetupSettingDefaults()}async OnThemeChange(e){di(e,document)}GetZIndexSettingString(){let e="";return this.ZMAPLAYER&&(e+=y.MAPLAYER),this.ZGRIDLAYER&&(e+=y.GRIDLAYER),this.ZDRAWINGLAYER&&(e+=y.DRAWINGLAYER),this.ZPROPLAYER&&(e+=y.PROPLAYER),this.ZMOUNTLAYER&&(e+=y.MOUNTLAYER),this.ZCHARLAYER&&(e+=y.CHARACTERLAYER),this.ZATTACHLAYER&&(e+=y.ATTACHLAYER),this.ZNOTELAYER&&(e+=y.NOTELAYER),this.ZTEXTLAYER&&(e+=y.TEXTLAYER),e}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",n={owlbearid:V.playerId},i={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:S.ANONAUTH,"x-manuel":e}),body:JSON.stringify(n)},o=await fetch(S.CHECKREGISTRATION,i);if(!o.ok){const r=await o.json();console.error("Error:",r);return}(await o.json()).Data==="OK"?(this.USER_REGISTERED=!0,console.log("Connected")):console.log("Not Registered")}catch(e){console.error("Error:",e)}}}const V=new D([D.ROOMMETA,D.SCENEITEMS,D.PLAYER]);function Ds(){const t=document.createElement("img");return t.id="PatreonButton",t.setAttribute("class","icon"),t.classList.add("clickable"),t.setAttribute("title",V.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),t.setAttribute("src",V.USER_REGISTERED?"w-thankyou.svg":"/w-patreon-2.png"),t.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},t}function un(){let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n==="x"?i:i&3|8).toString(16)})}function ui(t,e){let n;return function(o){clearTimeout(n),n=setTimeout(()=>{t(o)},e)}}function di(t,e){const n=window.matchMedia("(prefers-color-scheme: dark)"),i=n.matches?"dark":"light",o=n.matches?"light":"dark";for(var s=0;s<e.styleSheets.length;s++)for(var r=0;r<e.styleSheets[s].cssRules.length;r++){let c=e.styleSheets[s].cssRules[r];c&&c.media&&c.media.mediaText.includes("prefers-color-scheme")&&(t.mode=="LIGHT"?(c.media.appendMedium(`(prefers-color-scheme: ${i})`),c.media.mediaText.includes(o)&&c.media.deleteMedium(`(prefers-color-scheme: ${o})`)):t.mode=="DARK"&&(c.media.appendMedium(`(prefers-color-scheme: ${o})`),c.media.mediaText.includes(i)&&c.media.deleteMedium(`(prefers-color-scheme: ${i})`)))}}function Ue(t){return V.roomMetadata[t]}function Be(t){return(V.roomMetadata[te.ZINDEXES]??"").includes(t)}var q="top",ae="bottom",ce="right",J="left",Hn="auto",Tt=[q,ae,ce,J],nt="start",Ot="end",xs="clippingParents",$i="viewport",lt="popper",Ps="reference",li=Tt.reduce(function(t,e){return t.concat([e+"-"+nt,e+"-"+Ot])},[]),ji=[].concat(Tt,[Hn]).reduce(function(t,e){return t.concat([e,e+"-"+nt,e+"-"+Ot])},[]),Hs="beforeRead",Gs="read",Ys="afterRead",Us="beforeMain",ks="main",Vs="afterMain",$s="beforeWrite",js="write",Ws="afterWrite",Fs=[Hs,Gs,Ys,Us,ks,Vs,$s,js,Ws];function Ae(t){return t?(t.nodeName||"").toLowerCase():null}function oe(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function $e(t){var e=oe(t).Element;return t instanceof e||t instanceof Element}function re(t){var e=oe(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Gn(t){if(typeof ShadowRoot>"u")return!1;var e=oe(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Xs(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var i=e.styles[n]||{},o=e.attributes[n]||{},s=e.elements[n];!re(s)||!Ae(s)||(Object.assign(s.style,i),Object.keys(o).forEach(function(r){var c=o[r];c===!1?s.removeAttribute(r):s.setAttribute(r,c===!0?"":c)}))})}function Zs(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(i){var o=e.elements[i],s=e.attributes[i]||{},r=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:n[i]),c=r.reduce(function(u,d){return u[d]="",u},{});!re(o)||!Ae(o)||(Object.assign(o.style,c),Object.keys(s).forEach(function(u){o.removeAttribute(u)}))})}}const Wi={name:"applyStyles",enabled:!0,phase:"write",fn:Xs,effect:Zs,requires:["computeStyles"]};function Oe(t){return t.split("-")[0]}var ke=Math.max,Xt=Math.min,it=Math.round;function On(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Fi(){return!/^((?!chrome|android).)*safari/i.test(On())}function ot(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var i=t.getBoundingClientRect(),o=1,s=1;e&&re(t)&&(o=t.offsetWidth>0&&it(i.width)/t.offsetWidth||1,s=t.offsetHeight>0&&it(i.height)/t.offsetHeight||1);var r=$e(t)?oe(t):window,c=r.visualViewport,u=!Fi()&&n,d=(i.left+(u&&c?c.offsetLeft:0))/o,a=(i.top+(u&&c?c.offsetTop:0))/s,f=i.width/o,v=i.height/s;return{width:f,height:v,top:a,right:d+f,bottom:a+v,left:d,x:d,y:a}}function Yn(t){var e=ot(t),n=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:i}}function Xi(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&Gn(n)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function we(t){return oe(t).getComputedStyle(t)}function Ks(t){return["table","td","th"].indexOf(Ae(t))>=0}function Le(t){return(($e(t)?t.ownerDocument:t.document)||window.document).documentElement}function Jt(t){return Ae(t)==="html"?t:t.assignedSlot||t.parentNode||(Gn(t)?t.host:null)||Le(t)}function fi(t){return!re(t)||we(t).position==="fixed"?null:t.offsetParent}function zs(t){var e=/firefox/i.test(On()),n=/Trident/i.test(On());if(n&&re(t)){var i=we(t);if(i.position==="fixed")return null}var o=Jt(t);for(Gn(o)&&(o=o.host);re(o)&&["html","body"].indexOf(Ae(o))<0;){var s=we(o);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return o;o=o.parentNode}return null}function _t(t){for(var e=oe(t),n=fi(t);n&&Ks(n)&&we(n).position==="static";)n=fi(n);return n&&(Ae(n)==="html"||Ae(n)==="body"&&we(n).position==="static")?e:n||zs(t)||e}function Un(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function vt(t,e,n){return ke(t,Xt(e,n))}function qs(t,e,n){var i=vt(t,e,n);return i>n?n:i}function Zi(){return{top:0,right:0,bottom:0,left:0}}function Ki(t){return Object.assign({},Zi(),t)}function zi(t,e){return e.reduce(function(n,i){return n[i]=t,n},{})}var Js=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,Ki(typeof e!="number"?e:zi(e,Tt))};function Qs(t){var e,n=t.state,i=t.name,o=t.options,s=n.elements.arrow,r=n.modifiersData.popperOffsets,c=Oe(n.placement),u=Un(c),d=[J,ce].indexOf(c)>=0,a=d?"height":"width";if(!(!s||!r)){var f=Js(o.padding,n),v=Yn(s),p=u==="y"?q:J,E=u==="y"?ae:ce,m=n.rects.reference[a]+n.rects.reference[u]-r[u]-n.rects.popper[a],A=r[u]-n.rects.reference[u],T=_t(s),I=T?u==="y"?T.clientHeight||0:T.clientWidth||0:0,b=m/2-A/2,l=f[p],w=I-v[a]-f[E],O=I/2-v[a]/2+b,L=vt(l,O,w),G=u;n.modifiersData[i]=(e={},e[G]=L,e.centerOffset=L-O,e)}}function er(t){var e=t.state,n=t.options,i=n.element,o=i===void 0?"[data-popper-arrow]":i;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||Xi(e.elements.popper,o)&&(e.elements.arrow=o))}const tr={name:"arrow",enabled:!0,phase:"main",fn:Qs,effect:er,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function st(t){return t.split("-")[1]}var nr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ir(t,e){var n=t.x,i=t.y,o=e.devicePixelRatio||1;return{x:it(n*o)/o||0,y:it(i*o)/o||0}}function hi(t){var e,n=t.popper,i=t.popperRect,o=t.placement,s=t.variation,r=t.offsets,c=t.position,u=t.gpuAcceleration,d=t.adaptive,a=t.roundOffsets,f=t.isFixed,v=r.x,p=v===void 0?0:v,E=r.y,m=E===void 0?0:E,A=typeof a=="function"?a({x:p,y:m}):{x:p,y:m};p=A.x,m=A.y;var T=r.hasOwnProperty("x"),I=r.hasOwnProperty("y"),b=J,l=q,w=window;if(d){var O=_t(n),L="clientHeight",G="clientWidth";if(O===oe(n)&&(O=Le(n),we(O).position!=="static"&&c==="absolute"&&(L="scrollHeight",G="scrollWidth")),O=O,o===q||(o===J||o===ce)&&s===Ot){l=ae;var H=f&&O===w&&w.visualViewport?w.visualViewport.height:O[L];m-=H-i.height,m*=u?1:-1}if(o===J||(o===q||o===ae)&&s===Ot){b=ce;var x=f&&O===w&&w.visualViewport?w.visualViewport.width:O[G];p-=x-i.width,p*=u?1:-1}}var Y=Object.assign({position:c},d&&nr),P=a===!0?ir({x:p,y:m},oe(n)):{x:p,y:m};if(p=P.x,m=P.y,u){var M;return Object.assign({},Y,(M={},M[l]=I?"0":"",M[b]=T?"0":"",M.transform=(w.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",M))}return Object.assign({},Y,(e={},e[l]=I?m+"px":"",e[b]=T?p+"px":"",e.transform="",e))}function or(t){var e=t.state,n=t.options,i=n.gpuAcceleration,o=i===void 0?!0:i,s=n.adaptive,r=s===void 0?!0:s,c=n.roundOffsets,u=c===void 0?!0:c,d={placement:Oe(e.placement),variation:st(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,hi(Object.assign({},d,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:r,roundOffsets:u})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,hi(Object.assign({},d,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const sr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:or,data:{}};var Yt={passive:!0};function rr(t){var e=t.state,n=t.instance,i=t.options,o=i.scroll,s=o===void 0?!0:o,r=i.resize,c=r===void 0?!0:r,u=oe(e.elements.popper),d=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&d.forEach(function(a){a.addEventListener("scroll",n.update,Yt)}),c&&u.addEventListener("resize",n.update,Yt),function(){s&&d.forEach(function(a){a.removeEventListener("scroll",n.update,Yt)}),c&&u.removeEventListener("resize",n.update,Yt)}}const ar={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:rr,data:{}};var cr={left:"right",right:"left",bottom:"top",top:"bottom"};function $t(t){return t.replace(/left|right|bottom|top/g,function(e){return cr[e]})}var ur={start:"end",end:"start"};function pi(t){return t.replace(/start|end/g,function(e){return ur[e]})}function kn(t){var e=oe(t),n=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:n,scrollTop:i}}function Vn(t){return ot(Le(t)).left+kn(t).scrollLeft}function dr(t,e){var n=oe(t),i=Le(t),o=n.visualViewport,s=i.clientWidth,r=i.clientHeight,c=0,u=0;if(o){s=o.width,r=o.height;var d=Fi();(d||!d&&e==="fixed")&&(c=o.offsetLeft,u=o.offsetTop)}return{width:s,height:r,x:c+Vn(t),y:u}}function lr(t){var e,n=Le(t),i=kn(t),o=(e=t.ownerDocument)==null?void 0:e.body,s=ke(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),r=ke(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),c=-i.scrollLeft+Vn(t),u=-i.scrollTop;return we(o||n).direction==="rtl"&&(c+=ke(n.clientWidth,o?o.clientWidth:0)-s),{width:s,height:r,x:c,y:u}}function $n(t){var e=we(t),n=e.overflow,i=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+i)}function qi(t){return["html","body","#document"].indexOf(Ae(t))>=0?t.ownerDocument.body:re(t)&&$n(t)?t:qi(Jt(t))}function Et(t,e){var n;e===void 0&&(e=[]);var i=qi(t),o=i===((n=t.ownerDocument)==null?void 0:n.body),s=oe(i),r=o?[s].concat(s.visualViewport||[],$n(i)?i:[]):i,c=e.concat(r);return o?c:c.concat(Et(Jt(r)))}function An(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function fr(t,e){var n=ot(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function vi(t,e,n){return e===$i?An(dr(t,n)):$e(e)?fr(e,n):An(lr(Le(t)))}function hr(t){var e=Et(Jt(t)),n=["absolute","fixed"].indexOf(we(t).position)>=0,i=n&&re(t)?_t(t):t;return $e(i)?e.filter(function(o){return $e(o)&&Xi(o,i)&&Ae(o)!=="body"}):[]}function pr(t,e,n,i){var o=e==="clippingParents"?hr(t):[].concat(e),s=[].concat(o,[n]),r=s[0],c=s.reduce(function(u,d){var a=vi(t,d,i);return u.top=ke(a.top,u.top),u.right=Xt(a.right,u.right),u.bottom=Xt(a.bottom,u.bottom),u.left=ke(a.left,u.left),u},vi(t,r,i));return c.width=c.right-c.left,c.height=c.bottom-c.top,c.x=c.left,c.y=c.top,c}function Ji(t){var e=t.reference,n=t.element,i=t.placement,o=i?Oe(i):null,s=i?st(i):null,r=e.x+e.width/2-n.width/2,c=e.y+e.height/2-n.height/2,u;switch(o){case q:u={x:r,y:e.y-n.height};break;case ae:u={x:r,y:e.y+e.height};break;case ce:u={x:e.x+e.width,y:c};break;case J:u={x:e.x-n.width,y:c};break;default:u={x:e.x,y:e.y}}var d=o?Un(o):null;if(d!=null){var a=d==="y"?"height":"width";switch(s){case nt:u[d]=u[d]-(e[a]/2-n[a]/2);break;case Ot:u[d]=u[d]+(e[a]/2-n[a]/2);break}}return u}function At(t,e){e===void 0&&(e={});var n=e,i=n.placement,o=i===void 0?t.placement:i,s=n.strategy,r=s===void 0?t.strategy:s,c=n.boundary,u=c===void 0?xs:c,d=n.rootBoundary,a=d===void 0?$i:d,f=n.elementContext,v=f===void 0?lt:f,p=n.altBoundary,E=p===void 0?!1:p,m=n.padding,A=m===void 0?0:m,T=Ki(typeof A!="number"?A:zi(A,Tt)),I=v===lt?Ps:lt,b=t.rects.popper,l=t.elements[E?I:v],w=pr($e(l)?l:l.contextElement||Le(t.elements.popper),u,a,r),O=ot(t.elements.reference),L=Ji({reference:O,element:b,strategy:"absolute",placement:o}),G=An(Object.assign({},b,L)),H=v===lt?G:O,x={top:w.top-H.top+T.top,bottom:H.bottom-w.bottom+T.bottom,left:w.left-H.left+T.left,right:H.right-w.right+T.right},Y=t.modifiersData.offset;if(v===lt&&Y){var P=Y[o];Object.keys(x).forEach(function(M){var Q=[ce,ae].indexOf(M)>=0?1:-1,ee=[q,ae].indexOf(M)>=0?"y":"x";x[M]+=P[ee]*Q})}return x}function vr(t,e){e===void 0&&(e={});var n=e,i=n.placement,o=n.boundary,s=n.rootBoundary,r=n.padding,c=n.flipVariations,u=n.allowedAutoPlacements,d=u===void 0?ji:u,a=st(i),f=a?c?li:li.filter(function(E){return st(E)===a}):Tt,v=f.filter(function(E){return d.indexOf(E)>=0});v.length===0&&(v=f);var p=v.reduce(function(E,m){return E[m]=At(t,{placement:m,boundary:o,rootBoundary:s,padding:r})[Oe(m)],E},{});return Object.keys(p).sort(function(E,m){return p[E]-p[m]})}function Er(t){if(Oe(t)===Hn)return[];var e=$t(t);return[pi(t),e,pi(e)]}function mr(t){var e=t.state,n=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var o=n.mainAxis,s=o===void 0?!0:o,r=n.altAxis,c=r===void 0?!0:r,u=n.fallbackPlacements,d=n.padding,a=n.boundary,f=n.rootBoundary,v=n.altBoundary,p=n.flipVariations,E=p===void 0?!0:p,m=n.allowedAutoPlacements,A=e.options.placement,T=Oe(A),I=T===A,b=u||(I||!E?[$t(A)]:Er(A)),l=[A].concat(b).reduce(function(Te,ue){return Te.concat(Oe(ue)===Hn?vr(e,{placement:ue,boundary:a,rootBoundary:f,padding:d,flipVariations:E,allowedAutoPlacements:m}):ue)},[]),w=e.rects.reference,O=e.rects.popper,L=new Map,G=!0,H=l[0],x=0;x<l.length;x++){var Y=l[x],P=Oe(Y),M=st(Y)===nt,Q=[q,ae].indexOf(P)>=0,ee=Q?"width":"height",j=At(e,{placement:Y,boundary:a,rootBoundary:f,altBoundary:v,padding:d}),W=Q?M?ce:J:M?ae:q;w[ee]>O[ee]&&(W=$t(W));var U=$t(W),fe=[];if(s&&fe.push(j[P]<=0),c&&fe.push(j[W]<=0,j[U]<=0),fe.every(function(Te){return Te})){H=Y,G=!1;break}L.set(Y,fe)}if(G)for(var he=E?3:1,Me=function(ue){var _e=l.find(function(je){var Re=L.get(je);if(Re)return Re.slice(0,ue).every(function(We){return We})});if(_e)return H=_e,"break"},pe=he;pe>0;pe--){var De=Me(pe);if(De==="break")break}e.placement!==H&&(e.modifiersData[i]._skip=!0,e.placement=H,e.reset=!0)}}const yr={name:"flip",enabled:!0,phase:"main",fn:mr,requiresIfExists:["offset"],data:{_skip:!1}};function Ei(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function mi(t){return[q,ce,ae,J].some(function(e){return t[e]>=0})}function gr(t){var e=t.state,n=t.name,i=e.rects.reference,o=e.rects.popper,s=e.modifiersData.preventOverflow,r=At(e,{elementContext:"reference"}),c=At(e,{altBoundary:!0}),u=Ei(r,i),d=Ei(c,o,s),a=mi(u),f=mi(d);e.modifiersData[n]={referenceClippingOffsets:u,popperEscapeOffsets:d,isReferenceHidden:a,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":a,"data-popper-escaped":f})}const Or={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:gr};function Ar(t,e,n){var i=Oe(t),o=[J,q].indexOf(i)>=0?-1:1,s=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,r=s[0],c=s[1];return r=r||0,c=(c||0)*o,[J,ce].indexOf(i)>=0?{x:c,y:r}:{x:r,y:c}}function Tr(t){var e=t.state,n=t.options,i=t.name,o=n.offset,s=o===void 0?[0,0]:o,r=ji.reduce(function(a,f){return a[f]=Ar(f,e.rects,s),a},{}),c=r[e.placement],u=c.x,d=c.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=u,e.modifiersData.popperOffsets.y+=d),e.modifiersData[i]=r}const _r={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Tr};function Rr(t){var e=t.state,n=t.name;e.modifiersData[n]=Ji({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Ir={name:"popperOffsets",enabled:!0,phase:"read",fn:Rr,data:{}};function wr(t){return t==="x"?"y":"x"}function br(t){var e=t.state,n=t.options,i=t.name,o=n.mainAxis,s=o===void 0?!0:o,r=n.altAxis,c=r===void 0?!1:r,u=n.boundary,d=n.rootBoundary,a=n.altBoundary,f=n.padding,v=n.tether,p=v===void 0?!0:v,E=n.tetherOffset,m=E===void 0?0:E,A=At(e,{boundary:u,rootBoundary:d,padding:f,altBoundary:a}),T=Oe(e.placement),I=st(e.placement),b=!I,l=Un(T),w=wr(l),O=e.modifiersData.popperOffsets,L=e.rects.reference,G=e.rects.popper,H=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,x=typeof H=="number"?{mainAxis:H,altAxis:H}:Object.assign({mainAxis:0,altAxis:0},H),Y=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(O){if(s){var M,Q=l==="y"?q:J,ee=l==="y"?ae:ce,j=l==="y"?"height":"width",W=O[l],U=W+A[Q],fe=W-A[ee],he=p?-G[j]/2:0,Me=I===nt?L[j]:G[j],pe=I===nt?-G[j]:-L[j],De=e.elements.arrow,Te=p&&De?Yn(De):{width:0,height:0},ue=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Zi(),_e=ue[Q],je=ue[ee],Re=vt(0,L[j],Te[j]),We=b?L[j]/2-he-Re-_e-x.mainAxis:Me-Re-_e-x.mainAxis,be=b?-L[j]/2+he+Re+je+x.mainAxis:pe+Re+je+x.mainAxis,Fe=e.elements.arrow&&_t(e.elements.arrow),It=Fe?l==="y"?Fe.clientTop||0:Fe.clientLeft||0:0,rt=(M=Y?.[l])!=null?M:0,wt=W+We-rt-It,bt=W+be-rt,at=vt(p?Xt(U,wt):U,W,p?ke(fe,bt):fe);O[l]=at,P[l]=at-W}if(c){var ct,Ct=l==="x"?q:J,Bt=l==="x"?ae:ce,Ie=O[w],Ce=w==="y"?"height":"width",ut=Ie+A[Ct],xe=Ie-A[Bt],dt=[q,J].indexOf(T)!==-1,Nt=(ct=Y?.[w])!=null?ct:0,St=dt?ut:Ie-L[Ce]-G[Ce]-Nt+x.altAxis,Lt=dt?Ie+L[Ce]+G[Ce]-Nt-x.altAxis:xe,Mt=p&&dt?qs(St,Ie,Lt):vt(p?St:ut,Ie,p?Lt:xe);O[w]=Mt,P[w]=Mt-Ie}e.modifiersData[i]=P}}const Cr={name:"preventOverflow",enabled:!0,phase:"main",fn:br,requiresIfExists:["offset"]};function Br(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Nr(t){return t===oe(t)||!re(t)?kn(t):Br(t)}function Sr(t){var e=t.getBoundingClientRect(),n=it(e.width)/t.offsetWidth||1,i=it(e.height)/t.offsetHeight||1;return n!==1||i!==1}function Lr(t,e,n){n===void 0&&(n=!1);var i=re(e),o=re(e)&&Sr(e),s=Le(e),r=ot(t,o,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(i||!i&&!n)&&((Ae(e)!=="body"||$n(s))&&(c=Nr(e)),re(e)?(u=ot(e,!0),u.x+=e.clientLeft,u.y+=e.clientTop):s&&(u.x=Vn(s))),{x:r.left+c.scrollLeft-u.x,y:r.top+c.scrollTop-u.y,width:r.width,height:r.height}}function Mr(t){var e=new Map,n=new Set,i=[];t.forEach(function(s){e.set(s.name,s)});function o(s){n.add(s.name);var r=[].concat(s.requires||[],s.requiresIfExists||[]);r.forEach(function(c){if(!n.has(c)){var u=e.get(c);u&&o(u)}}),i.push(s)}return t.forEach(function(s){n.has(s.name)||o(s)}),i}function Dr(t){var e=Mr(t);return Fs.reduce(function(n,i){return n.concat(e.filter(function(o){return o.phase===i}))},[])}function xr(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function Pr(t){var e=t.reduce(function(n,i){var o=n[i.name];return n[i.name]=o?Object.assign({},o,i,{options:Object.assign({},o.options,i.options),data:Object.assign({},o.data,i.data)}):i,n},{});return Object.keys(e).map(function(n){return e[n]})}var yi={placement:"bottom",modifiers:[],strategy:"absolute"};function gi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Hr(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,i=n===void 0?[]:n,o=e.defaultOptions,s=o===void 0?yi:o;return function(c,u,d){d===void 0&&(d=s);var a={placement:"bottom",orderedModifiers:[],options:Object.assign({},yi,s),modifiersData:{},elements:{reference:c,popper:u},attributes:{},styles:{}},f=[],v=!1,p={state:a,setOptions:function(T){var I=typeof T=="function"?T(a.options):T;m(),a.options=Object.assign({},s,a.options,I),a.scrollParents={reference:$e(c)?Et(c):c.contextElement?Et(c.contextElement):[],popper:Et(u)};var b=Dr(Pr([].concat(i,a.options.modifiers)));return a.orderedModifiers=b.filter(function(l){return l.enabled}),E(),p.update()},forceUpdate:function(){if(!v){var T=a.elements,I=T.reference,b=T.popper;if(gi(I,b)){a.rects={reference:Lr(I,_t(b),a.options.strategy==="fixed"),popper:Yn(b)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach(function(x){return a.modifiersData[x.name]=Object.assign({},x.data)});for(var l=0;l<a.orderedModifiers.length;l++){if(a.reset===!0){a.reset=!1,l=-1;continue}var w=a.orderedModifiers[l],O=w.fn,L=w.options,G=L===void 0?{}:L,H=w.name;typeof O=="function"&&(a=O({state:a,options:G,name:H,instance:p})||a)}}}},update:xr(function(){return new Promise(function(A){p.forceUpdate(),A(a)})}),destroy:function(){m(),v=!0}};if(!gi(c,u))return p;p.setOptions(d).then(function(A){!v&&d.onFirstUpdate&&d.onFirstUpdate(A)});function E(){a.orderedModifiers.forEach(function(A){var T=A.name,I=A.options,b=I===void 0?{}:I,l=A.effect;if(typeof l=="function"){var w=l({state:a,name:T,instance:p,options:b}),O=function(){};f.push(w||O)}})}function m(){f.forEach(function(A){return A()}),f=[]}return p}}var Gr=[ar,Ir,sr,Wi,_r,yr,Cr,tr,Or],Yr=Hr({defaultModifiers:Gr}),Ur="tippy-box",Qi="tippy-content",kr="tippy-backdrop",eo="tippy-arrow",to="tippy-svg-arrow",Ge={passive:!0,capture:!0},no=function(){return document.body};function dn(t,e,n){if(Array.isArray(t)){var i=t[e];return i??(Array.isArray(n)?n[e]:n)}return t}function jn(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function io(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Oi(t,e){if(e===0)return t;var n;return function(i){clearTimeout(n),n=setTimeout(function(){t(i)},e)}}function Vr(t){return t.split(/\s+/).filter(Boolean)}function Qe(t){return[].concat(t)}function Ai(t,e){t.indexOf(e)===-1&&t.push(e)}function $r(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function jr(t){return t.split("-")[0]}function Zt(t){return[].slice.call(t)}function Ti(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function mt(){return document.createElement("div")}function Qt(t){return["Element","Fragment"].some(function(e){return jn(t,e)})}function Wr(t){return jn(t,"NodeList")}function Fr(t){return jn(t,"MouseEvent")}function Xr(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function Zr(t){return Qt(t)?[t]:Wr(t)?Zt(t):Array.isArray(t)?t:Zt(document.querySelectorAll(t))}function ln(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function _i(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function Kr(t){var e,n=Qe(t),i=n[0];return i!=null&&(e=i.ownerDocument)!=null&&e.body?i.ownerDocument:document}function zr(t,e){var n=e.clientX,i=e.clientY;return t.every(function(o){var s=o.popperRect,r=o.popperState,c=o.props,u=c.interactiveBorder,d=jr(r.placement),a=r.modifiersData.offset;if(!a)return!0;var f=d==="bottom"?a.top.y:0,v=d==="top"?a.bottom.y:0,p=d==="right"?a.left.x:0,E=d==="left"?a.right.x:0,m=s.top-i+f>u,A=i-s.bottom-v>u,T=s.left-n+p>u,I=n-s.right-E>u;return m||A||T||I})}function fn(t,e,n){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(o){t[i](o,n)})}function Ri(t,e){for(var n=e;n;){var i;if(t.contains(n))return!0;n=n.getRootNode==null||(i=n.getRootNode())==null?void 0:i.host}return!1}var ye={isTouch:!1},Ii=0;function qr(){ye.isTouch||(ye.isTouch=!0,window.performance&&document.addEventListener("mousemove",oo))}function oo(){var t=performance.now();t-Ii<20&&(ye.isTouch=!1,document.removeEventListener("mousemove",oo)),Ii=t}function Jr(){var t=document.activeElement;if(Xr(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Qr(){document.addEventListener("touchstart",qr,Ge),window.addEventListener("blur",Jr)}var ea=typeof window<"u"&&typeof document<"u",ta=ea?!!window.msCrypto:!1,na={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ia={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},le=Object.assign({appendTo:no,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},na,ia),oa=Object.keys(le),sa=function(e){var n=Object.keys(e);n.forEach(function(i){le[i]=e[i]})};function so(t){var e=t.plugins||[],n=e.reduce(function(i,o){var s=o.name,r=o.defaultValue;if(s){var c;i[s]=t[s]!==void 0?t[s]:(c=le[s])!=null?c:r}return i},{});return Object.assign({},t,n)}function ra(t,e){var n=e?Object.keys(so(Object.assign({},le,{plugins:e}))):oa,i=n.reduce(function(o,s){var r=(t.getAttribute("data-tippy-"+s)||"").trim();if(!r)return o;if(s==="content")o[s]=r;else try{o[s]=JSON.parse(r)}catch{o[s]=r}return o},{});return i}function wi(t,e){var n=Object.assign({},e,{content:io(e.content,[t])},e.ignoreAttributes?{}:ra(t,e.plugins));return n.aria=Object.assign({},le.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var aa=function(){return"innerHTML"};function Tn(t,e){t[aa()]=e}function bi(t){var e=mt();return t===!0?e.className=eo:(e.className=to,Qt(t)?e.appendChild(t):Tn(e,t)),e}function Ci(t,e){Qt(e.content)?(Tn(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Tn(t,e.content):t.textContent=e.content)}function _n(t){var e=t.firstElementChild,n=Zt(e.children);return{box:e,content:n.find(function(i){return i.classList.contains(Qi)}),arrow:n.find(function(i){return i.classList.contains(eo)||i.classList.contains(to)}),backdrop:n.find(function(i){return i.classList.contains(kr)})}}function ro(t){var e=mt(),n=mt();n.className=Ur,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=mt();i.className=Qi,i.setAttribute("data-state","hidden"),Ci(i,t.props),e.appendChild(n),n.appendChild(i),o(t.props,t.props);function o(s,r){var c=_n(e),u=c.box,d=c.content,a=c.arrow;r.theme?u.setAttribute("data-theme",r.theme):u.removeAttribute("data-theme"),typeof r.animation=="string"?u.setAttribute("data-animation",r.animation):u.removeAttribute("data-animation"),r.inertia?u.setAttribute("data-inertia",""):u.removeAttribute("data-inertia"),u.style.maxWidth=typeof r.maxWidth=="number"?r.maxWidth+"px":r.maxWidth,r.role?u.setAttribute("role",r.role):u.removeAttribute("role"),(s.content!==r.content||s.allowHTML!==r.allowHTML)&&Ci(d,t.props),r.arrow?a?s.arrow!==r.arrow&&(u.removeChild(a),u.appendChild(bi(r.arrow))):u.appendChild(bi(r.arrow)):a&&u.removeChild(a)}return{popper:e,onUpdate:o}}ro.$$tippy=!0;var ca=1,Ut=[],hn=[];function ua(t,e){var n=wi(t,Object.assign({},le,so(Ti(e)))),i,o,s,r=!1,c=!1,u=!1,d=!1,a,f,v,p=[],E=Oi(wt,n.interactiveDebounce),m,A=ca++,T=null,I=$r(n.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},l={id:A,reference:t,popper:mt(),popperInstance:T,props:n,state:b,plugins:I,clearDelayTimeouts:St,setProps:Lt,setContent:Mt,show:co,hide:uo,hideWithInteractivity:lo,enable:dt,disable:Nt,unmount:fo,destroy:ho};if(!n.render)return l;var w=n.render(l),O=w.popper,L=w.onUpdate;O.setAttribute("data-tippy-root",""),O.id="tippy-"+l.id,l.popper=O,t._tippy=l,O._tippy=l;var G=I.map(function(h){return h.fn(l)}),H=t.hasAttribute("aria-expanded");return Fe(),he(),W(),U("onCreate",[l]),n.showOnCreate&&ut(),O.addEventListener("mouseenter",function(){l.props.interactive&&l.state.isVisible&&l.clearDelayTimeouts()}),O.addEventListener("mouseleave",function(){l.props.interactive&&l.props.trigger.indexOf("mouseenter")>=0&&Q().addEventListener("mousemove",E)}),l;function x(){var h=l.props.touch;return Array.isArray(h)?h:[h,0]}function Y(){return x()[0]==="hold"}function P(){var h;return!!((h=l.props.render)!=null&&h.$$tippy)}function M(){return m||t}function Q(){var h=M().parentNode;return h?Kr(h):document}function ee(){return _n(O)}function j(h){return l.state.isMounted&&!l.state.isVisible||ye.isTouch||a&&a.type==="focus"?0:dn(l.props.delay,h?0:1,le.delay)}function W(h){h===void 0&&(h=!1),O.style.pointerEvents=l.props.interactive&&!h?"":"none",O.style.zIndex=""+l.props.zIndex}function U(h,g,R){if(R===void 0&&(R=!0),G.forEach(function(C){C[h]&&C[h].apply(C,g)}),R){var B;(B=l.props)[h].apply(B,g)}}function fe(){var h=l.props.aria;if(h.content){var g="aria-"+h.content,R=O.id,B=Qe(l.props.triggerTarget||t);B.forEach(function(C){var X=C.getAttribute(g);if(l.state.isVisible)C.setAttribute(g,X?X+" "+R:R);else{var se=X&&X.replace(R,"").trim();se?C.setAttribute(g,se):C.removeAttribute(g)}})}}function he(){if(!(H||!l.props.aria.expanded)){var h=Qe(l.props.triggerTarget||t);h.forEach(function(g){l.props.interactive?g.setAttribute("aria-expanded",l.state.isVisible&&g===M()?"true":"false"):g.removeAttribute("aria-expanded")})}}function Me(){Q().removeEventListener("mousemove",E),Ut=Ut.filter(function(h){return h!==E})}function pe(h){if(!(ye.isTouch&&(u||h.type==="mousedown"))){var g=h.composedPath&&h.composedPath()[0]||h.target;if(!(l.props.interactive&&Ri(O,g))){if(Qe(l.props.triggerTarget||t).some(function(R){return Ri(R,g)})){if(ye.isTouch||l.state.isVisible&&l.props.trigger.indexOf("click")>=0)return}else U("onClickOutside",[l,h]);l.props.hideOnClick===!0&&(l.clearDelayTimeouts(),l.hide(),c=!0,setTimeout(function(){c=!1}),l.state.isMounted||_e())}}}function De(){u=!0}function Te(){u=!1}function ue(){var h=Q();h.addEventListener("mousedown",pe,!0),h.addEventListener("touchend",pe,Ge),h.addEventListener("touchstart",Te,Ge),h.addEventListener("touchmove",De,Ge)}function _e(){var h=Q();h.removeEventListener("mousedown",pe,!0),h.removeEventListener("touchend",pe,Ge),h.removeEventListener("touchstart",Te,Ge),h.removeEventListener("touchmove",De,Ge)}function je(h,g){We(h,function(){!l.state.isVisible&&O.parentNode&&O.parentNode.contains(O)&&g()})}function Re(h,g){We(h,g)}function We(h,g){var R=ee().box;function B(C){C.target===R&&(fn(R,"remove",B),g())}if(h===0)return g();fn(R,"remove",f),fn(R,"add",B),f=B}function be(h,g,R){R===void 0&&(R=!1);var B=Qe(l.props.triggerTarget||t);B.forEach(function(C){C.addEventListener(h,g,R),p.push({node:C,eventType:h,handler:g,options:R})})}function Fe(){Y()&&(be("touchstart",rt,{passive:!0}),be("touchend",bt,{passive:!0})),Vr(l.props.trigger).forEach(function(h){if(h!=="manual")switch(be(h,rt),h){case"mouseenter":be("mouseleave",bt);break;case"focus":be(ta?"focusout":"blur",at);break;case"focusin":be("focusout",at);break}})}function It(){p.forEach(function(h){var g=h.node,R=h.eventType,B=h.handler,C=h.options;g.removeEventListener(R,B,C)}),p=[]}function rt(h){var g,R=!1;if(!(!l.state.isEnabled||ct(h)||c)){var B=((g=a)==null?void 0:g.type)==="focus";a=h,m=h.currentTarget,he(),!l.state.isVisible&&Fr(h)&&Ut.forEach(function(C){return C(h)}),h.type==="click"&&(l.props.trigger.indexOf("mouseenter")<0||r)&&l.props.hideOnClick!==!1&&l.state.isVisible?R=!0:ut(h),h.type==="click"&&(r=!R),R&&!B&&xe(h)}}function wt(h){var g=h.target,R=M().contains(g)||O.contains(g);if(!(h.type==="mousemove"&&R)){var B=Ce().concat(O).map(function(C){var X,se=C._tippy,Xe=(X=se.popperInstance)==null?void 0:X.state;return Xe?{popperRect:C.getBoundingClientRect(),popperState:Xe,props:n}:null}).filter(Boolean);zr(B,h)&&(Me(),xe(h))}}function bt(h){var g=ct(h)||l.props.trigger.indexOf("click")>=0&&r;if(!g){if(l.props.interactive){l.hideWithInteractivity(h);return}xe(h)}}function at(h){l.props.trigger.indexOf("focusin")<0&&h.target!==M()||l.props.interactive&&h.relatedTarget&&O.contains(h.relatedTarget)||xe(h)}function ct(h){return ye.isTouch?Y()!==h.type.indexOf("touch")>=0:!1}function Ct(){Bt();var h=l.props,g=h.popperOptions,R=h.placement,B=h.offset,C=h.getReferenceClientRect,X=h.moveTransition,se=P()?_n(O).arrow:null,Xe=C?{getBoundingClientRect:C,contextElement:C.contextElement||M()}:t,Wn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Dt){var Ze=Dt.state;if(P()){var po=ee(),tn=po.box;["placement","reference-hidden","escaped"].forEach(function(xt){xt==="placement"?tn.setAttribute("data-placement",Ze.placement):Ze.attributes.popper["data-popper-"+xt]?tn.setAttribute("data-"+xt,""):tn.removeAttribute("data-"+xt)}),Ze.attributes.popper={}}}},Pe=[{name:"offset",options:{offset:B}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!X}},Wn];P()&&se&&Pe.push({name:"arrow",options:{element:se,padding:3}}),Pe.push.apply(Pe,g?.modifiers||[]),l.popperInstance=Yr(Xe,O,Object.assign({},g,{placement:R,onFirstUpdate:v,modifiers:Pe}))}function Bt(){l.popperInstance&&(l.popperInstance.destroy(),l.popperInstance=null)}function Ie(){var h=l.props.appendTo,g,R=M();l.props.interactive&&h===no||h==="parent"?g=R.parentNode:g=io(h,[R]),g.contains(O)||g.appendChild(O),l.state.isMounted=!0,Ct()}function Ce(){return Zt(O.querySelectorAll("[data-tippy-root]"))}function ut(h){l.clearDelayTimeouts(),h&&U("onTrigger",[l,h]),ue();var g=j(!0),R=x(),B=R[0],C=R[1];ye.isTouch&&B==="hold"&&C&&(g=C),g?i=setTimeout(function(){l.show()},g):l.show()}function xe(h){if(l.clearDelayTimeouts(),U("onUntrigger",[l,h]),!l.state.isVisible){_e();return}if(!(l.props.trigger.indexOf("mouseenter")>=0&&l.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(h.type)>=0&&r)){var g=j(!1);g?o=setTimeout(function(){l.state.isVisible&&l.hide()},g):s=requestAnimationFrame(function(){l.hide()})}}function dt(){l.state.isEnabled=!0}function Nt(){l.hide(),l.state.isEnabled=!1}function St(){clearTimeout(i),clearTimeout(o),cancelAnimationFrame(s)}function Lt(h){if(!l.state.isDestroyed){U("onBeforeUpdate",[l,h]),It();var g=l.props,R=wi(t,Object.assign({},g,Ti(h),{ignoreAttributes:!0}));l.props=R,Fe(),g.interactiveDebounce!==R.interactiveDebounce&&(Me(),E=Oi(wt,R.interactiveDebounce)),g.triggerTarget&&!R.triggerTarget?Qe(g.triggerTarget).forEach(function(B){B.removeAttribute("aria-expanded")}):R.triggerTarget&&t.removeAttribute("aria-expanded"),he(),W(),L&&L(g,R),l.popperInstance&&(Ct(),Ce().forEach(function(B){requestAnimationFrame(B._tippy.popperInstance.forceUpdate)})),U("onAfterUpdate",[l,h])}}function Mt(h){l.setProps({content:h})}function co(){var h=l.state.isVisible,g=l.state.isDestroyed,R=!l.state.isEnabled,B=ye.isTouch&&!l.props.touch,C=dn(l.props.duration,0,le.duration);if(!(h||g||R||B)&&!M().hasAttribute("disabled")&&(U("onShow",[l],!1),l.props.onShow(l)!==!1)){if(l.state.isVisible=!0,P()&&(O.style.visibility="visible"),W(),ue(),l.state.isMounted||(O.style.transition="none"),P()){var X=ee(),se=X.box,Xe=X.content;ln([se,Xe],0)}v=function(){var Pe;if(!(!l.state.isVisible||d)){if(d=!0,O.offsetHeight,O.style.transition=l.props.moveTransition,P()&&l.props.animation){var en=ee(),Dt=en.box,Ze=en.content;ln([Dt,Ze],C),_i([Dt,Ze],"visible")}fe(),he(),Ai(hn,l),(Pe=l.popperInstance)==null||Pe.forceUpdate(),U("onMount",[l]),l.props.animation&&P()&&Re(C,function(){l.state.isShown=!0,U("onShown",[l])})}},Ie()}}function uo(){var h=!l.state.isVisible,g=l.state.isDestroyed,R=!l.state.isEnabled,B=dn(l.props.duration,1,le.duration);if(!(h||g||R)&&(U("onHide",[l],!1),l.props.onHide(l)!==!1)){if(l.state.isVisible=!1,l.state.isShown=!1,d=!1,r=!1,P()&&(O.style.visibility="hidden"),Me(),_e(),W(!0),P()){var C=ee(),X=C.box,se=C.content;l.props.animation&&(ln([X,se],B),_i([X,se],"hidden"))}fe(),he(),l.props.animation?P()&&je(B,l.unmount):l.unmount()}}function lo(h){Q().addEventListener("mousemove",E),Ai(Ut,E),E(h)}function fo(){l.state.isVisible&&l.hide(),l.state.isMounted&&(Bt(),Ce().forEach(function(h){h._tippy.unmount()}),O.parentNode&&O.parentNode.removeChild(O),hn=hn.filter(function(h){return h!==l}),l.state.isMounted=!1,U("onHidden",[l]))}function ho(){l.state.isDestroyed||(l.clearDelayTimeouts(),l.unmount(),It(),delete t._tippy,l.state.isDestroyed=!0,U("onDestroy",[l]))}}function Rt(t,e){e===void 0&&(e={});var n=le.plugins.concat(e.plugins||[]);Qr();var i=Object.assign({},e,{plugins:n}),o=Zr(t),s=o.reduce(function(r,c){var u=c&&ua(c,i);return u&&r.push(u),r},[]);return Qt(t)?s[0]:s}Rt.defaultProps=le;Rt.setDefaultProps=sa;Rt.currentInput=ye;Object.assign({},Wi,{effect:function(e){var n=e.state,i={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,i.popper),n.styles=i,n.elements.arrow&&Object.assign(n.elements.arrow.style,i.arrow)}});Rt.setDefaultProps({render:ro});function da(t,e){const n=document.getElementById(`${t}`);n&&Rt(n,{content:e,theme:"battlesystem"})}class la{appWindow;constructor(){this.appWindow=document.getElementById("app")}async Initialize(){this.appWindow=document.getElementById("app"),V.playerRole==="GM"?(this.appWindow.innerHTML=S.MAINHTML,V.sceneReady&&await V.UpdateZIndex(V.sceneItems),me(y.DISABLEBIND,Ue(te.DISABLEBIND)),me(y.KEEPATTACH,Ue(te.KEEPATTACH)),me(y.MAPLAYER,Be(y.MAPLAYER)),me(y.DRAWINGLAYER,Be(y.DRAWINGLAYER)),me(y.PROPLAYER,Be(y.PROPLAYER)),me(y.MOUNTLAYER,Be(y.MOUNTLAYER)),me(y.CHARACTERLAYER,Be(y.CHARACTERLAYER)),me(y.ATTACHLAYER,Be(y.ATTACHLAYER)),me(y.NOTELAYER,Be(y.NOTELAYER)),me(y.TEXTLAYER,Be(y.TEXTLAYER)),this.CreateTooltips()):(this.appWindow.innerHTML='<div id="playerView">Configuration is GM only.<div id="patreonContainer"></div></div>',await _.action.setHeight(50)),document.getElementById("patreonContainer").appendChild(Ds()),await xn(),await Vi(),await Pn()}CreateTooltips(){const e=new Map;e.set("tip_removebind","Removes the button for players that allows binding tokens together."),e.set("tip_attachparent","Makes it so attachments stay with the parent token when Flipping between tokens."),e.set("tip_zindex","Controls which layers the auto Z-Indexing is active on."),e.forEach((n,i)=>{da(i,n)})}}const ao=new la;_.onReady(async()=>{if(await _.scene.isReady()===!1){const e=_.scene.onReadyChange(async n=>{n&&(e(),await Bi())})}else await Bi()});async function Bi(){await V.InitializeCache(),V.SetupHandlers(),await ao.Initialize(),await xn(),await Vi(),await Pn()}
