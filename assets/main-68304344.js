(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var Z=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class ps{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return Z(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return Z(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return Z(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return Z(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return Z(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return Z(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return Z(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return Z(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:i}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return i.indexOf(e)>-1})}getConnectionId(){return Z(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=i=>{e(i.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var de=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class vs{constructor(e){this.messageBus=e}reset(){return de(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return de(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return de(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return de(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return de(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return de(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return de(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function Es(t){return typeof t.id=="string"}var Rn={exports:{}},et=typeof Reflect=="object"?Reflect:null,Fn=et&&typeof et.apply=="function"?et.apply:function(e,n,i){return Function.prototype.apply.call(e,n,i)},kt;et&&typeof et.ownKeys=="function"?kt=et.ownKeys:Object.getOwnPropertySymbols?kt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:kt=function(e){return Object.getOwnPropertyNames(e)};function ms(t){console&&console.warn&&console.warn(t)}var Ni=Number.isNaN||function(e){return e!==e};function S(){S.init.call(this)}Rn.exports=S;Rn.exports.once=Ts;S.EventEmitter=S;S.prototype._events=void 0;S.prototype._eventsCount=0;S.prototype._maxListeners=void 0;var Xn=10;function Kt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return Xn},set:function(t){if(typeof t!="number"||t<0||Ni(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Xn=t}});S.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};S.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ni(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Si(t){return t._maxListeners===void 0?S.defaultMaxListeners:t._maxListeners}S.prototype.getMaxListeners=function(){return Si(this)};S.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var r;if(n.length>0&&(r=n[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")Fn(u,this,n);else for(var d=u.length,a=Pi(u,d),i=0;i<d;++i)Fn(a[i],this,n);return!0};function Li(t,e,n,i){var s,o,r;if(Kt(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),r=o[e]),r===void 0)r=o[e]=n,++t._eventsCount;else if(typeof r=="function"?r=o[e]=i?[n,r]:[r,n]:i?r.unshift(n):r.push(n),s=Si(t),s>0&&r.length>s&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=r.length,ms(c)}return t}S.prototype.addListener=function(e,n){return Li(this,e,n,!1)};S.prototype.on=S.prototype.addListener;S.prototype.prependListener=function(e,n){return Li(this,e,n,!0)};function ys(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Mi(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=ys.bind(i);return s.listener=n,i.wrapFn=s,s}S.prototype.once=function(e,n){return Kt(n),this.on(e,Mi(this,e,n)),this};S.prototype.prependOnceListener=function(e,n){return Kt(n),this.prependListener(e,Mi(this,e,n)),this};S.prototype.removeListener=function(e,n){var i,s,o,r,c;if(Kt(n),s=this._events,s===void 0)return this;if(i=s[e],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||n));else if(typeof i!="function"){for(o=-1,r=i.length-1;r>=0;r--)if(i[r]===n||i[r].listener===n){c=i[r].listener,o=r;break}if(o<0)return this;o===0?i.shift():gs(i,o),i.length===1&&(s[e]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",e,c||n)}return this};S.prototype.off=S.prototype.removeListener;S.prototype.removeAllListeners=function(e){var n,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var o=Object.keys(i),r;for(s=0;s<o.length;++s)r=o[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Di(t,e,n){var i=t._events;if(i===void 0)return[];var s=i[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?As(s):Pi(s,s.length)}S.prototype.listeners=function(e){return Di(this,e,!0)};S.prototype.rawListeners=function(e){return Di(this,e,!1)};S.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):xi.call(t,e)};S.prototype.listenerCount=xi;function xi(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}S.prototype.eventNames=function(){return this._eventsCount>0?kt(this._events):[]};function Pi(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function gs(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function As(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Ts(t,e){return new Promise(function(n,i){function s(r){t.removeListener(e,o),i(r)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Hi(t,e,o,{once:!0}),e!=="error"&&Os(t,s,{once:!0})})}function Os(t,e,n){typeof t.on=="function"&&Hi(t,"error",e,n)}function Hi(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(o){i.once&&t.removeEventListener(e,s),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var _s=Rn.exports;let Pt;const Rs=new Uint8Array(16);function Is(){if(!Pt&&(Pt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pt(Rs)}const k=[];for(let t=0;t<256;++t)k.push((t+256).toString(16).slice(1));function ws(t,e=0){return k[t[e+0]]+k[t[e+1]]+k[t[e+2]]+k[t[e+3]]+"-"+k[t[e+4]]+k[t[e+5]]+"-"+k[t[e+6]]+k[t[e+7]]+"-"+k[t[e+8]]+k[t[e+9]]+"-"+k[t[e+10]]+k[t[e+11]]+k[t[e+12]]+k[t[e+13]]+k[t[e+14]]+k[t[e+15]]}const Bs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zn={randomUUID:Bs};function bs(t,e,n){if(Zn.randomUUID&&!e&&!t)return Zn.randomUUID();t=t||{};const i=t.random||(t.rng||Is)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=i[s];return e}return ws(i)}class Cs extends _s.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=i=>{const s=i.data;if(i.origin===this.targetOrigin&&Es(s)){if(s.id==="OBR_READY"){this.ready=!0;const o=s.data;this.ref=o.ref,this.userId=o.userId}this.emit(s.id,s.data)}},this.send=(i,s,o)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:i,data:s,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(i,s,o=5e3)=>{const r=`_${bs()}`;return this.send(i,s,r),Promise.race([new Promise((c,u)=>{const d=this;function a(m){d.off(`${i}_RESPONSE${r}`,a),d.off(`${i}_ERROR${r}`,l),c(m)}function l(m){d.off(`${i}_RESPONSE${r}`,a),d.off(`${i}_ERROR${r}`,l),u(m)}this.on(`${i}_RESPONSE${r}`,a),this.on(`${i}_ERROR${r}`,l)}),new Promise((c,u)=>window.setTimeout(()=>u(new Error(`Message ${i} took longer than ${o}ms to get a result`)),o))])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Kn=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ns{constructor(e){this.messageBus=e}show(e,n){return Kn(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return i})}close(e){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var Ke=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ss{constructor(e){this.messageBus=e}getColor(){return Ke(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return Ke(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return Ke(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return Ke(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=i=>{e(i.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var K=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ls{constructor(e){this.messageBus=e}getDpi(){return K(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return K(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return K(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return K(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return K(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return K(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return K(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,i,s){return K(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:i,useCenter:s});return o})}getDistance(e,n){return K(this,void 0,void 0,function*(){const{distance:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return i})}onChange(e){const n=i=>{e(i.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Ht=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ms{constructor(e){this.messageBus=e}undo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Ht(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Ht(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function F(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function $e(t){return!!t&&!!t[ne]}function Ne(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var i=Object.getPrototypeOf(n);if(i===null)return!0;var s=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===ks}(t)||Array.isArray(t)||!!t[ht]||!!(!((e=t.constructor)===null||e===void 0)&&e[ht])||zt(t)||qt(t))}function tt(t,e,n){n===void 0&&(n=!1),Se(t)===0?(n?Object.keys:Sn)(t).forEach(function(i){n&&typeof i=="symbol"||e(i,t[i],t)}):t.forEach(function(i,s){return e(s,i,t)})}function Se(t){var e=t[ne];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:zt(t)?2:qt(t)?3:0}function yt(t,e){return Se(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function $t(t,e){return Se(t)===2?t.get(e):t[e]}function Gi(t,e,n){var i=Se(t);i===2?t.set(e,n):i===3?t.add(n):t[e]=n}function Ds(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function zt(t){return Ys&&t instanceof Map}function qt(t){return Us&&t instanceof Set}function He(t){return t.o||t.t}function In(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=$s(t);delete e[ne];for(var n=Sn(e),i=0;i<n.length;i++){var s=n[i],o=e[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function wn(t,e){return e===void 0&&(e=!1),Bn(t)||$e(t)||!Ne(t)||(Se(t)>1&&(t.set=t.add=t.clear=t.delete=xs),Object.freeze(t),e&&tt(t,function(n,i){return wn(i,!0)},!0)),t}function xs(){F(2)}function Bn(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function ge(t){var e=mn[t];return e||F(18,t),e}function Ps(t,e){mn[t]||(mn[t]=e)}function zn(){return gt}function nn(t,e){e&&(ge("Patches"),t.u=[],t.s=[],t.v=e)}function jt(t){pn(t),t.p.forEach(Hs),t.p=null}function pn(t){t===gt&&(gt=t.l)}function qn(t){return gt={p:[],l:gt,h:t,m:!0,_:0}}function Hs(t){var e=t[ne];e.i===0||e.i===1?e.j():e.g=!0}function sn(t,e){e._=e.p.length;var n=e.p[0],i=t!==void 0&&t!==n;return e.h.O||ge("ES5").S(e,t,i),i?(n[ne].P&&(jt(e),F(4)),Ne(t)&&(t=Wt(e,t),e.l||Ft(e,t)),e.u&&ge("Patches").M(n[ne].t,t,e.u,e.s)):t=Wt(e,n,[]),jt(e),e.u&&e.v(e.u,e.s),t!==Nn?t:void 0}function Wt(t,e,n){if(Bn(e))return e;var i=e[ne];if(!i)return tt(e,function(c,u){return Jn(t,i,e,c,u,n)},!0),e;if(i.A!==t)return e;if(!i.P)return Ft(t,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var s=i.i===4||i.i===5?i.o=In(i.k):i.o,o=s,r=!1;i.i===3&&(o=new Set(s),s.clear(),r=!0),tt(o,function(c,u){return Jn(t,i,s,c,u,n,r)}),Ft(t,s,!1),n&&t.u&&ge("Patches").N(i,n,t.u,t.s)}return i.o}function Jn(t,e,n,i,s,o,r){if($e(s)){var c=Wt(t,s,o&&e&&e.i!==3&&!yt(e.R,i)?o.concat(i):void 0);if(Gi(n,i,c),!$e(c))return;t.m=!1}else r&&n.add(s);if(Ne(s)&&!Bn(s)){if(!t.h.D&&t._<1)return;Wt(t,s),e&&e.A.l||Ft(t,s)}}function Ft(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&wn(e,n)}function on(t,e){var n=t[ne];return(n?He(n):t)[e]}function Qn(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=Object.getPrototypeOf(n)}}function vn(t){t.P||(t.P=!0,t.l&&vn(t.l))}function rn(t){t.o||(t.o=In(t.t))}function En(t,e,n){var i=zt(e)?ge("MapSet").F(e,n):qt(e)?ge("MapSet").T(e,n):t.O?function(s,o){var r=Array.isArray(s),c={i:r?1:0,A:o?o.A:zn(),P:!1,I:!1,R:{},l:o,t:s,k:null,o:null,j:null,C:!1},u=c,d=yn;r&&(u=[c],d=ft);var a=Proxy.revocable(u,d),l=a.revoke,m=a.proxy;return c.k=m,c.j=l,m}(e,n):ge("ES5").J(e,n);return(n?n.A:zn()).p.push(i),i}function Gs(t){return $e(t)||F(22,t),function e(n){if(!Ne(n))return n;var i,s=n[ne],o=Se(n);if(s){if(!s.P&&(s.i<4||!ge("ES5").K(s)))return s.t;s.I=!0,i=ei(n,o),s.I=!1}else i=ei(n,o);return tt(i,function(r,c){s&&$t(s.t,r)===c||Gi(i,r,e(c))}),o===3?new Set(i):i}(t)}function ei(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return In(t)}function bn(){function t(i){if(!Ne(i))return i;if(Array.isArray(i))return i.map(t);if(zt(i))return new Map(Array.from(i.entries()).map(function(r){return[r[0],t(r[1])]}));if(qt(i))return new Set(Array.from(i).map(t));var s=Object.create(Object.getPrototypeOf(i));for(var o in i)s[o]=t(i[o]);return yt(i,ht)&&(s[ht]=i[ht]),s}function e(i){return $e(i)?t(i):i}var n="add";Ps("Patches",{$:function(i,s){return s.forEach(function(o){for(var r=o.path,c=o.op,u=i,d=0;d<r.length-1;d++){var a=Se(u),l=r[d];typeof l!="string"&&typeof l!="number"&&(l=""+l),a!==0&&a!==1||l!=="__proto__"&&l!=="constructor"||F(24),typeof u=="function"&&l==="prototype"&&F(24),typeof(u=$t(u,l))!="object"&&F(15,r.join("/"))}var m=Se(u),p=t(o.value),v=r[r.length-1];switch(c){case"replace":switch(m){case 2:return u.set(v,p);case 3:F(16);default:return u[v]=p}case n:switch(m){case 1:return v==="-"?u.push(p):u.splice(v,0,p);case 2:return u.set(v,p);case 3:return u.add(p);default:return u[v]=p}case"remove":switch(m){case 1:return u.splice(v,1);case 2:return u.delete(v);case 3:return u.delete(o.value);default:return delete u[v]}default:F(17,c)}}),i},N:function(i,s,o,r){switch(i.i){case 0:case 4:case 2:return function(c,u,d,a){var l=c.t,m=c.o;tt(c.R,function(p,v){var y=$t(l,p),g=$t(m,p),R=v?yt(l,p)?"replace":n:"remove";if(y!==g||R!=="replace"){var I=u.concat(p);d.push(R==="remove"?{op:R,path:I}:{op:R,path:I,value:g}),a.push(R===n?{op:"remove",path:I}:R==="remove"?{op:n,path:I,value:e(y)}:{op:"replace",path:I,value:e(y)})}})}(i,s,o,r);case 5:case 1:return function(c,u,d,a){var l=c.t,m=c.R,p=c.o;if(p.length<l.length){var v=[p,l];l=v[0],p=v[1];var y=[a,d];d=y[0],a=y[1]}for(var g=0;g<l.length;g++)if(m[g]&&p[g]!==l[g]){var R=u.concat([g]);d.push({op:"replace",path:R,value:e(p[g])}),a.push({op:"replace",path:R,value:e(l[g])})}for(var I=l.length;I<p.length;I++){var w=u.concat([I]);d.push({op:n,path:w,value:e(p[I])})}l.length<p.length&&a.push({op:"replace",path:u.concat(["length"]),value:l.length})}(i,s,o,r);case 3:return function(c,u,d,a){var l=c.t,m=c.o,p=0;l.forEach(function(v){if(!m.has(v)){var y=u.concat([p]);d.push({op:"remove",path:y,value:v}),a.unshift({op:n,path:y,value:v})}p++}),p=0,m.forEach(function(v){if(!l.has(v)){var y=u.concat([p]);d.push({op:n,path:y,value:v}),a.unshift({op:"remove",path:y,value:v})}p++})}(i,s,o,r)}},M:function(i,s,o,r){o.push({op:"replace",path:[],value:s===Nn?void 0:s}),r.push({op:"replace",path:[],value:i})}})}var ti,gt,Cn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Ys=typeof Map<"u",Us=typeof Set<"u",ni=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Nn=Cn?Symbol.for("immer-nothing"):((ti={})["immer-nothing"]=!0,ti),ht=Cn?Symbol.for("immer-draftable"):"__$immer_draftable",ne=Cn?Symbol.for("immer-state"):"__$immer_state",ks=""+Object.prototype.constructor,Sn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,$s=Object.getOwnPropertyDescriptors||function(t){var e={};return Sn(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},mn={},yn={get:function(t,e){if(e===ne)return t;var n=He(t);if(!yt(n,e))return function(s,o,r){var c,u=Qn(o,r);return u?"value"in u?u.value:(c=u.get)===null||c===void 0?void 0:c.call(s.k):void 0}(t,n,e);var i=n[e];return t.I||!Ne(i)?i:i===on(t.t,e)?(rn(t),t.o[e]=En(t.A.h,i,t)):i},has:function(t,e){return e in He(t)},ownKeys:function(t){return Reflect.ownKeys(He(t))},set:function(t,e,n){var i=Qn(He(t),e);if(i?.set)return i.set.call(t.k,n),!0;if(!t.P){var s=on(He(t),e),o=s?.[ne];if(o&&o.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Ds(n,s)&&(n!==void 0||yt(t.t,e)))return!0;rn(t),vn(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return on(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,rn(t),vn(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=He(t),i=Reflect.getOwnPropertyDescriptor(n,e);return i&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:i.enumerable,value:n[e]}},defineProperty:function(){F(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){F(12)}},ft={};tt(yn,function(t,e){ft[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),ft.deleteProperty=function(t,e){return ft.set.call(this,t,e,void 0)},ft.set=function(t,e,n){return yn.set.call(this,t[0],e,n,t[0])};var Vs=function(){function t(n){var i=this;this.O=ni,this.D=!0,this.produce=function(s,o,r){if(typeof s=="function"&&typeof o!="function"){var c=o;o=s;var u=i;return function(y){var g=this;y===void 0&&(y=c);for(var R=arguments.length,I=Array(R>1?R-1:0),w=1;w<R;w++)I[w-1]=arguments[w];return u.produce(y,function(f){var B;return(B=o).call.apply(B,[g,f].concat(I))})}}var d;if(typeof o!="function"&&F(6),r!==void 0&&typeof r!="function"&&F(7),Ne(s)){var a=qn(i),l=En(i,s,void 0),m=!0;try{d=o(l),m=!1}finally{m?jt(a):pn(a)}return typeof Promise<"u"&&d instanceof Promise?d.then(function(y){return nn(a,r),sn(y,a)},function(y){throw jt(a),y}):(nn(a,r),sn(d,a))}if(!s||typeof s!="object"){if((d=o(s))===void 0&&(d=s),d===Nn&&(d=void 0),i.D&&wn(d,!0),r){var p=[],v=[];ge("Patches").M(s,d,p,v),r(p,v)}return d}F(21,s)},this.produceWithPatches=function(s,o){if(typeof s=="function")return function(d){for(var a=arguments.length,l=Array(a>1?a-1:0),m=1;m<a;m++)l[m-1]=arguments[m];return i.produceWithPatches(d,function(p){return s.apply(void 0,[p].concat(l))})};var r,c,u=i.produce(s,o,function(d,a){r=d,c=a});return typeof Promise<"u"&&u instanceof Promise?u.then(function(d){return[d,r,c]}):[u,r,c]},typeof n?.useProxies=="boolean"&&this.setUseProxies(n.useProxies),typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Ne(n)||F(8),$e(n)&&(n=Gs(n));var i=qn(this),s=En(this,n,void 0);return s[ne].C=!0,pn(i),s},e.finishDraft=function(n,i){var s=n&&n[ne],o=s.A;return nn(o,i),sn(void 0,o)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!ni&&F(20),this.O=n},e.applyPatches=function(n,i){var s;for(s=i.length-1;s>=0;s--){var o=i[s];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}s>-1&&(i=i.slice(s+1));var r=ge("Patches").$;return $e(n)?r(n,i):this.produce(n,function(c){return r(c,i)})},t}(),ie=new Vs;ie.produce;var Ln=ie.produceWithPatches.bind(ie);ie.setAutoFreeze.bind(ie);ie.setUseProxies.bind(ie);ie.applyPatches.bind(ie);ie.createDraft.bind(ie);ie.finishDraft.bind(ie);var ze=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};bn();class js{constructor(e){this.messageBus=e}getItems(e){return ze(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,i=!0){return ze(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[o,r]=Ln(s,n),c=o.map(u=>({id:u.id,type:u.type}));for(const u of r){const[d,a]=u.path;typeof d=="number"&&typeof a=="string"&&(c[d][a]=o[d][a])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:c,updateAttachments:i})})}addItems(e){return ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return ze(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ze(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return ze(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var qe=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};bn();class Ws{constructor(e){this.messageBus=e}getItems(e){return qe(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,i,s=!0){return qe(this,void 0,void 0,function*(){const o=yield this.getItems(e),[r,c]=Ln(o,n),u=r.map(d=>({id:d.id,type:d.type}));for(const d of c){const[a,l]=d.path;typeof a=="number"&&typeof l=="string"&&(u[a][l]=r[a][l])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:u,fastUpdate:i,updateAttachments:s})})}addItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return qe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return qe(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return qe(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var an=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Fs{constructor(e){this.messageBus=e,this.grid=new Ls(e),this.fog=new Ss(e),this.history=new Ms(e),this.items=new js(e),this.local=new Ws(e)}isReady(){return an(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=i=>{e(i.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return an(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return an(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=i=>{e(i.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Yi(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function pt(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Yi(e.icon)}))}function Mn(t){return Object.assign(Object.assign({},t),{url:Yi(t.url)})}var ii=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Xs{constructor(e){this.contextMenus={},this.handleClick=n=>{var i;const s=this.contextMenus[n.id];s&&((i=s.onClick)===null||i===void 0||i.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return ii(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),embed:e.embed&&Mn(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return ii(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var ve=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Zs{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const i=this.tools[n.id];if(i)if(i.onClick){const s=i.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var i;const s=this.toolActions[n.id];s&&((i=s.onClick)===null||i===void 0||i.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onClick){const s=i.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onToolClick){const s=i.onToolClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const i=this.toolModes[n.id];if(i)if(i.onToolDoubleClick){const s=i.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolDown)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolMove)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolUp)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolDragStart)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolDragMove)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolDragEnd)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onToolDragCancel)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onKeyDown)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onKeyUp)===null||i===void 0||i.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onActivate)===null||i===void 0||i.call(s,n.context))},this.handleToolModeDeactivate=n=>{var i;const s=this.toolModes[n.id];s&&((i=s.onDeactivate)===null||i===void 0||i.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:pt(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return ve(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:pt(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var Je=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class Ks{constructor(e){this.messageBus=e}open(e){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Mn(e)))})}close(e){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return Je(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return Je(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return Je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var si=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class zs{constructor(e){this.messageBus=e}open(e){return si(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Mn(e)))})}close(e){return si(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var z=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class qs{constructor(e){this.messageBus=e}getWidth(){return z(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return z(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return z(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return z(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return z(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return z(this,void 0,void 0,function*(){const n=pt([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return z(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return z(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=i=>{e(i.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Js=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};bn();class Qs{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Js(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[c=>{const[u,d]=Ln(s,c);return s=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:i,patches:d}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:i})}]})}}var eo=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class to{constructor(e){this.messageBus=e}getPlayers(){return eo(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=i=>{e(i.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var cn=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class no{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return cn(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return cn(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=i=>{e(i.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=i=>{e(i.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var io=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class so{constructor(e){this.messageBus=e}getTheme(){return io(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=i=>{e(i.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var oi=globalThis&&globalThis.__awaiter||function(t,e,n,i){function s(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function c(a){try{d(i.next(a))}catch(l){r(l)}}function u(a){try{d(i.throw(a))}catch(l){r(l)}}function d(a){a.done?o(a.value):s(a.value).then(c,u)}d((i=i.apply(t,e||[])).next())})};class oo{constructor(e){this.messageBus=e}uploadImages(e){return oi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e})})}uploadScenes(e){return oi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e})})}}const ro=typeof atob=="function",Dn=typeof Buffer=="function",ri=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const ao="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",co=Array.prototype.slice.call(ao),Gt=(t=>{let e={};return t.forEach((n,i)=>e[n]=i),e})(co),uo=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ye=String.fromCharCode.bind(String),ai=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ui=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),lo=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,fo=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Ye((n>>>10)+55296)+Ye((n&1023)+56320);case 3:return Ye((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Ye((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},ho=t=>t.replace(lo,fo),po=t=>{if(t=t.replace(/\s+/g,""),!uo.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",i,s;for(let o=0;o<t.length;)e=Gt[t.charAt(o++)]<<18|Gt[t.charAt(o++)]<<12|(i=Gt[t.charAt(o++)])<<6|(s=Gt[t.charAt(o++)]),n+=i===64?Ye(e>>16&255):s===64?Ye(e>>16&255,e>>8&255):Ye(e>>16&255,e>>8&255,e&255);return n},ki=ro?t=>atob(Ui(t)):Dn?t=>Buffer.from(t,"base64").toString("binary"):po,vo=Dn?t=>ai(Buffer.from(t,"base64")):t=>ai(ki(t).split("").map(e=>e.charCodeAt(0))),Eo=Dn?t=>Buffer.from(t,"base64").toString("utf8"):ri?t=>ri.decode(vo(t)):t=>ho(ki(t)),mo=t=>Ui(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),yo=t=>Eo(mo(t));function go(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",i="";if(e){const o=yo(e).split(" ");o.length===2&&(n=o[0],i=o[1])}return{origin:n,roomId:i}}var ci;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(ci||(ci={}));const gn=go(),V=new Cs(gn.origin,gn.roomId),Ao=new vs(V),To=new ps(V),Oo=new to(V),_o=new Ns(V),Ro=new Fs(V),Io=new Xs(V),wo=new Zs(V),Bo=new Ks(V),bo=new zs(V),Co=new qs(V),No=new Qs(V),So=new no(V),Lo=new so(V),Mo=new oo(V),O={onReady:t=>{V.ready?t():V.once("OBR_READY",()=>t())},get isReady(){return V.ready},viewport:Ao,player:To,party:Oo,notification:_o,scene:Ro,contextMenu:Io,tool:wo,popover:Bo,modal:bo,action:Co,interaction:No,room:So,theme:Lo,assets:Mo,isAvailable:!!gn.origin};function Ee(t){return`<label class="switch" id="setting${t}Container">
        <span class="slider round"></span>
        </label>`}function me(t,e){const n=document.getElementById(`setting${t}Container`),i=document.createElement("input");i.type="checkbox",i.value=String(e),i.checked=e,i.onclick=async function(o){const r=o.target;switch(i.value=String(r.checked),t){case E.DISABLEBIND:await O.room.setMetadata({[te.DISABLEBIND]:r.checked});break;case E.KEEPATTACH:await O.room.setMetadata({[te.KEEPATTACH]:r.checked});break;case E.MAPLAYER:await s(E.MAPLAYER,r.checked);break;case E.DRAWINGLAYER:await s(E.DRAWINGLAYER,r.checked);break;case E.PROPLAYER:await s(E.PROPLAYER,r.checked);break;case E.MOUNTLAYER:await s(E.MOUNTLAYER,r.checked);break;case E.CHARACTERLAYER:await s(E.CHARACTERLAYER,r.checked);break;case E.ATTACHLAYER:await s(E.ATTACHLAYER,r.checked);break;case E.NOTELAYER:await s(E.NOTELAYER,r.checked);break;case E.TEXTLAYER:await s(E.TEXTLAYER,r.checked);break}},n?.insertBefore(i,n.firstChild);async function s(o,r){const c=r?$.ZLAYERING+=o:$.ZLAYERING.split(o).join("");await O.room.setMetadata({[te.ZINDEXES]:c})}}class E{static MAPLAYER="M";static GRIDLAYER="G";static DRAWINGLAYER="D";static PROPLAYER="P";static MOUNTLAYER="H";static CHARACTERLAYER="C";static ATTACHLAYER="A";static NOTELAYER="N";static TEXTLAYER="T";static DISABLEBIND="NOBIND";static KEEPATTACH="KEEPATTACH"}class C{static EXTENSIONID="com.battle-system.flip";static VERSION="whatsnew-flip-201";static CONTEXTFLIPID="com.battle-system.flip-menu/context-menu-flipit";static CONTEXTFLOPID="com.battle-system.flip-menu/context-menu-flopit";static CONTEXTBINDID="com.battle-system.flip-menu/context-menu-bindit";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static CHECKREGISTRATION="https://vrwtdtmnbyhaehtitrlb.supabase.co/functions/v1/patreon-check";static MAINHTML=`
    <div class="container">
        <table>
            <thead>
                <tr class="head-title">
                    <th>Flip!</th>
                    <th></th>
                    <th></th>
                    <th><div id="patreonContainer"></div></th>
                </tr>
            </thead>
            <tbody>
                <tr id="tip_removebind">
                    <td colspan ="3">Disable Player Bind</td>
                    <td>${Ee(E.DISABLEBIND)}</td>
                </tr>
                <tr id="tip_attachparent">
                    <td colspan ="3">Attachments with Parent</td>
                    <td>${Ee(E.KEEPATTACH)}</td>
                </tr>
                <tr id="tip_zindex">
                    <td class="title" colspan ="4">Z-Indexing Layers</td>
                </tr>
                <tr>
                    <td>Map</td>
                    <td>${Ee(E.MAPLAYER)}</td>
                    <td>Prop</td>
                    <td>${Ee(E.PROPLAYER)}</td>
                </tr>
                <tr>
                    <td>Character</td>
                    <td>${Ee(E.CHARACTERLAYER)}</td>
                    <td>Mount</td>
                    <td>${Ee(E.MOUNTLAYER)}</td>
                </tr>
                <tr>
                    <td>Attachment</td>
                    <td>${Ee(E.ATTACHLAYER)}</td>
                    <td>Note</td>
                    <td>${Ee(E.NOTELAYER)}</td>
                </tr>
                <tr>
                    <td>Drawing</td>
                    <td>${Ee(E.DRAWINGLAYER)}</td>
                    <td>Text</td>
                    <td>${Ee(E.TEXTLAYER)}</td>
                </tr>
            </tbody>
        </table>
    </div>`}class te{static DISABLEBIND=`${C.EXTENSIONID}/disableBinding`;static KEEPATTACH=`${C.EXTENSIONID}/attachmentParent`;static ZINDEXES=`${C.EXTENSIONID}/zLayering`}async function xn(){$.playerRole==="PLAYER"&&Ue(te.DISABLEBIND)||await O.contextMenu.create({id:C.CONTEXTFLOPID,icons:[{icon:"/flop.svg",label:"Flip It!",filter:{every:[{key:["metadata",`${C.EXTENSIONID}/metadata_bind`],value:void 0,operator:"!="}],some:[{key:"type",operator:"==",value:"IMAGE",coordinator:"||"},{key:"type",operator:"==",value:"TEXT"}]}}],async onClick(t,e){let n=[],i=[],s=[],o=[];await O.player.deselect(t.items.map(a=>a.id));const c=(await O.scene.items.getItemAttachments(t.items.map(a=>a.id))).filter(a=>!t.items.find(l=>l.id==a.id)),u=(await O.scene.items.getItems()).map(a=>a.id);for(let a of t.items){const l=JSON.parse(a.metadata[`${C.EXTENSIONID}/metadata_bind`]),p=u.includes(l.id)?un():void 0;if(p&&(l.id=p),$.KEEPATTACHMENTS){const v=(await O.scene.items.getItemAttachments([a.id]))?.filter(g=>g.id!==a.id);v?.length>0?(a.metadata[`${C.EXTENSIONID}/metadata_bind_attachments`]=JSON.stringify(v),s=s.concat(v)):a.metadata[`${C.EXTENSIONID}/metadata_bind_attachments`]=void 0;const y=l.metadata[`${C.EXTENSIONID}/metadata_bind_attachments`];if(y){let g=a.position.x-l.position.x,R=a.position.y-l.position.y;const I=JSON.parse(y);for(const w of I)w.position.x+=g,w.position.y+=R,p&&(w.id=un(),w.attachedTo=p);n=n.concat(I)}}else for(let v of c)if(t.items.find(g=>g.id===v.attachedTo)){const g={...v};g.attachedTo=p||l.id,p&&(g.id=un()),o.push(g)}if(l.position.x=a.position.x,l.position.y=a.position.y,a.type==="IMAGE"&&l.type==="TEXT"){const v=l.metadata[`${C.EXTENSIONID}/text_bounds`];l.position.x-=v.width/2,l.position.y-=v.height/2}else if(a.type==="TEXT"&&l.type==="IMAGE"){const v=await O.scene.items.getItemBounds([a.id]);l.position.x+=v.width/2,l.position.y+=v.height/2,a.metadata[`${C.EXTENSIONID}/text_bounds`]=v}a.metadata[`${C.EXTENSIONID}/metadata_bind`]=void 0,l.metadata[`${C.EXTENSIONID}/metadata_bind`]=JSON.stringify(a),n.push(l),i.push(l.id),s.push(a)}await O.scene.items.addItems(n),$.KEEPATTACHMENTS||await O.scene.items.updateItems(c,a=>{for(let l of a){const m=o.find(p=>p.id===l.id);m&&(l.attachedTo=m.attachedTo)}}),await O.scene.items.deleteItems(s.map(a=>a.id));const d=i;await O.player.select(d)}})}async function $i(){await O.contextMenu.create({id:C.CONTEXTFLIPID,icons:[{icon:"/flip.svg",label:"Reverse It",filter:{every:[{key:"type",value:"IMAGE",operator:"==",coordinator:"||"},{key:"type",value:"TEXT",operator:"=="}]}}],async onClick(t,e){const n=await Promise.all(t.items.map(async i=>{if(i.type==="TEXT"){const s=await O.scene.items.getItemBounds([i.id]);return{id:i.id,width:s.width}}return{id:void 0,width:void 0}}));await O.scene.items.updateItems(t.items,i=>{for(let s of i)if(s.scale.x=-s.scale.x,s.type==="TEXT"){const o=n.find(r=>r.id===s.id)?.width;o&&(s.position.x=s.scale.x<0?s.position.x+o:s.position.x-o)}})}})}async function Pn(){$.playerRole==="PLAYER"&&Ue(te.DISABLEBIND)||await O.contextMenu.create({id:C.CONTEXTBINDID,icons:[{icon:"/combine.svg",label:"Bind It",filter:{min:2,max:2,every:[{key:["metadata",`${C.EXTENSIONID}/metadata_bind`],value:void 0,operator:"=="}],some:[{key:"type",operator:"==",value:"IMAGE",coordinator:"||"},{key:"type",operator:"==",value:"TEXT"}]}},{icon:"/split.svg",label:"Un-Bind It",filter:{max:1,every:[{key:["metadata",`${C.EXTENSIONID}/metadata_bind`],value:void 0,operator:"!="}],some:[{key:"type",operator:"==",value:"IMAGE",coordinator:"||"},{key:"type",operator:"==",value:"TEXT"}]}}],async onClick(t,e){if(t.items.length==1){const n=t.items[0],i=JSON.parse(n.metadata[`${C.EXTENSIONID}/metadata_bind`]);n.type==="IMAGE"?(i.position.x=n.position.x+n.image.width/2,i.position.y=n.position.y+n.image.height/4,i.metadata[`${C.EXTENSIONID}/metadata_bind`]=void 0):(i.position.x=n.position.x+50,i.position.y=n.position.y+50,i.metadata[`${C.EXTENSIONID}/metadata_bind`]=void 0),await O.scene.items.updateItems(s=>s.id===n.id,s=>{for(let o of s)o.metadata[`${C.EXTENSIONID}/metadata_bind`]=void 0}),await O.scene.items.addItems([i])}else{const n=t.items[0],i=t.items[1];if(i.type==="TEXT"){const s=await O.scene.items.getItemBounds([i.id]);i.metadata[`${C.EXTENSIONID}/text_bounds`]=s}await O.scene.items.updateItems([t.items[0]],s=>{for(let o=0;o<s.length;o++)s[o].metadata[`${C.EXTENSIONID}/metadata_bind`]=JSON.stringify(i)}),await O.scene.items.deleteItems([i.id]),await O.player.select([n.id])}}})}class D{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static ROOMMETA="ROOMMETADATA";debouncedOnSceneItemsChange;debouncedOnSceneMetadataChange;CHARACTER_CACHE;USER_REGISTERED;LOADING;playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;gridDpi;gridScale;sceneItems;sceneSelected;sceneMetadata;sceneReady;oldRoomMetadata;roomMetadata;theme;caches;BINDINGDISABLED=!1;KEEPATTACHMENTS=!1;ZLAYERING="";ZMAPLAYER=!1;ZGRIDLAYER=!1;ZDRAWINGLAYER=!1;ZPROPLAYER=!1;ZMOUNTLAYER=!1;ZCHARLAYER=!1;ZATTACHLAYER=!1;ZNOTELAYER=!1;ZTEXTLAYER=!1;sceneMetadataHandler;sceneItemsHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.sceneItems=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.sceneReady=!1,this.theme="DARK",this.oldRoomMetadata={},this.roomMetadata={},this.LOADING=!1,this.CHARACTER_CACHE=[],this.USER_REGISTERED=!1,this.caches=e,this.debouncedOnSceneItemsChange=ui(this.OnSceneItemsChange.bind(this),100),this.debouncedOnSceneMetadataChange=ui(this.OnSceneMetadataChanges.bind(this),100)}async InitializeCache(){this.sceneReady=await O.scene.isReady(),this.theme=await O.theme.getTheme(),di(this.theme,document),this.caches.includes(D.PLAYER)&&(this.playerId=await O.player.getId(),this.playerName=await O.player.getName(),this.playerColor=await O.player.getColor(),this.playerMetadata=await O.player.getMetadata(),this.playerRole=await O.player.getRole()),this.caches.includes(D.PARTY)&&(this.party=await O.party.getPlayers()),this.caches.includes(D.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await O.scene.items.getItems()),this.caches.includes(D.SCENEMETA)&&this.sceneReady&&(this.sceneMetadata=await O.scene.getMetadata()),this.caches.includes(D.SCENEGRID)&&this.sceneReady&&(this.gridDpi=await O.scene.grid.getDpi(),this.gridScale=(await O.scene.grid.getScale()).parsed?.multiplier??5),this.caches.includes(D.ROOMMETA)&&(this.sceneReady&&(this.roomMetadata=await O.room.getMetadata()),await this.SetupSettingDefaults()),await this.CheckRegistration()}KillHandlers(){this.caches.includes(D.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(D.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(D.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(D.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(D.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(D.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(D.SCENEMETA)&&(this.sceneMetadataHandler=O.scene.onMetadataChange(async e=>{this.sceneMetadata=e,this.debouncedOnSceneMetadataChange(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(D.SCENEITEMS)&&(this.sceneItemsHandler=O.scene.items.onChange(async e=>{this.sceneItems=e,this.debouncedOnSceneItemsChange(e)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(D.SCENEGRID)&&(this.sceneGridHandler=O.scene.grid.onChange(async e=>{this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale),await this.OnSceneGridChange(e)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(D.PLAYER)&&(this.playerHandler=O.player.onChange(async e=>{this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e)})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(D.PARTY)&&(this.partyHandler=O.party.onChange(async e=>{this.party=e.filter(n=>n.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(D.ROOMMETA)&&(this.roomHandler=O.room.onMetadataChange(async e=>{this.roomMetadata=e,await this.OnRoomMetadataChange(e),this.oldRoomMetadata=e})),this.themeHandler===void 0&&(this.themeHandler=O.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=O.scene.onReadyChange(async e=>{this.sceneReady=e,e&&(this.sceneItems=await O.scene.items.getItems(),this.sceneMetadata=await O.scene.getMetadata(),this.gridDpi=await O.scene.grid.getDpi(),this.gridScale=(await O.scene.grid.getScale()).parsed?.multiplier??5),await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){}async UpdateZIndex(e){const n=[];this.ZMAPLAYER&&n.push("MAP"),this.ZGRIDLAYER&&n.push("GRID"),this.ZDRAWINGLAYER&&n.push("DRAWING"),this.ZPROPLAYER&&n.push("PROP"),this.ZMOUNTLAYER&&n.push("MOUNT"),this.ZCHARLAYER&&n.push("CHARACTER"),this.ZATTACHLAYER&&n.push("ATTACHMENT"),this.ZNOTELAYER&&n.push("NOTE"),this.ZTEXTLAYER&&n.push("TEXT"),await O.scene.items.updateItems(e,i=>{for(let s of i)if(n.includes(s.layer)){const o=s.type==="IMAGE"?s.position.y*100+s.image.height/6:s.position.y*100;(s.zIndex!==o&&s.metadata[`${C.EXTENSIONID}/metadata_flip`]!==void 0||s.metadata[`${C.EXTENSIONID}/metadata_flip`]===void 0)&&(s.metadata[`${C.EXTENSIONID}/metadata_flip`]={anchor:o},s.zIndex=o)}})}async OnSceneItemsChange(e){this.sceneReady&&await this.UpdateZIndex(e)}async OnSceneGridChange(e){}async OnSceneReadyChange(e){e&&await as.Initialize()}async OnPlayerChange(e){}async OnPartyChange(e){}async SetupSettingDefaults(){this.BINDINGDISABLED=Ue(te.DISABLEBIND)??!1,this.KEEPATTACHMENTS=Ue(te.KEEPATTACH)??!1,this.ZLAYERING=Ue(te.ZINDEXES)??"",this.ZMAPLAYER=this.ZLAYERING.includes(E.MAPLAYER),this.ZGRIDLAYER=this.ZLAYERING.includes(E.GRIDLAYER),this.ZDRAWINGLAYER=this.ZLAYERING.includes(E.DRAWINGLAYER),this.ZPROPLAYER=this.ZLAYERING.includes(E.PROPLAYER),this.ZMOUNTLAYER=this.ZLAYERING.includes(E.MOUNTLAYER),this.ZCHARLAYER=this.ZLAYERING.includes(E.CHARACTERLAYER),this.ZATTACHLAYER=this.ZLAYERING.includes(E.ATTACHLAYER),this.ZNOTELAYER=this.ZLAYERING.includes(E.NOTELAYER),this.ZTEXTLAYER=this.ZLAYERING.includes(E.TEXTLAYER),this.roomMetadata[te.DISABLEBIND]!==this.oldRoomMetadata[te.DISABLEBIND]&&this.playerRole==="PLAYER"&&(this.BINDINGDISABLED?(await O.contextMenu.remove(C.CONTEXTBINDID),await O.contextMenu.remove(C.CONTEXTFLOPID)):await Pn(),await xn())}async OnRoomMetadataChange(e){await this.SetupSettingDefaults()}async OnThemeChange(e){di(e,document)}GetZIndexSettingString(){let e="";return this.ZMAPLAYER&&(e+=E.MAPLAYER),this.ZGRIDLAYER&&(e+=E.GRIDLAYER),this.ZDRAWINGLAYER&&(e+=E.DRAWINGLAYER),this.ZPROPLAYER&&(e+=E.PROPLAYER),this.ZMOUNTLAYER&&(e+=E.MOUNTLAYER),this.ZCHARLAYER&&(e+=E.CHARACTERLAYER),this.ZATTACHLAYER&&(e+=E.ATTACHLAYER),this.ZNOTELAYER&&(e+=E.NOTELAYER),this.ZTEXTLAYER&&(e+=E.TEXTLAYER),e}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",n={owlbearid:$.playerId},i={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:C.ANONAUTH,"x-manuel":e}),body:JSON.stringify(n)},s=await fetch(C.CHECKREGISTRATION,i);if(!s.ok){const r=await s.json();console.error("Error:",r);return}(await s.json()).Data==="OK"?(this.USER_REGISTERED=!0,console.log("Connected")):console.log("Not Registered")}catch(e){console.error("Error:",e)}}}const $=new D([D.ROOMMETA,D.SCENEITEMS,D.PLAYER]);function Do(){const t=document.createElement("img");return t.id="PatreonButton",t.setAttribute("class","icon"),t.classList.add("clickable"),t.setAttribute("title",$.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),t.setAttribute("src",$.USER_REGISTERED?"w-thankyou.svg":"/w-patreon-2.png"),t.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},t}function un(){let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n==="x"?i:i&3|8).toString(16)})}function ui(t,e){let n;return function(s){clearTimeout(n),n=setTimeout(()=>{t(s)},e)}}function di(t,e){const n=window.matchMedia("(prefers-color-scheme: dark)"),i=n.matches?"dark":"light",s=n.matches?"light":"dark";for(var o=0;o<e.styleSheets.length;o++)for(var r=0;r<e.styleSheets[o].cssRules.length;r++){let c=e.styleSheets[o].cssRules[r];c&&c.media&&c.media.mediaText.includes("prefers-color-scheme")&&(t.mode=="LIGHT"?(c.media.appendMedium(`(prefers-color-scheme: ${i})`),c.media.mediaText.includes(s)&&c.media.deleteMedium(`(prefers-color-scheme: ${s})`)):t.mode=="DARK"&&(c.media.appendMedium(`(prefers-color-scheme: ${s})`),c.media.mediaText.includes(i)&&c.media.deleteMedium(`(prefers-color-scheme: ${i})`)))}}function Ue(t){return $.roomMetadata[t]}function Ce(t){return($.roomMetadata[te.ZINDEXES]??"").includes(t)}var q="top",ae="bottom",ce="right",J="left",Hn="auto",Ot=[q,ae,ce,J],nt="start",At="end",xo="clippingParents",Vi="viewport",lt="popper",Po="reference",li=Ot.reduce(function(t,e){return t.concat([e+"-"+nt,e+"-"+At])},[]),ji=[].concat(Ot,[Hn]).reduce(function(t,e){return t.concat([e,e+"-"+nt,e+"-"+At])},[]),Ho="beforeRead",Go="read",Yo="afterRead",Uo="beforeMain",ko="main",$o="afterMain",Vo="beforeWrite",jo="write",Wo="afterWrite",Fo=[Ho,Go,Yo,Uo,ko,$o,Vo,jo,Wo];function Te(t){return t?(t.nodeName||"").toLowerCase():null}function se(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ve(t){var e=se(t).Element;return t instanceof e||t instanceof Element}function re(t){var e=se(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Gn(t){if(typeof ShadowRoot>"u")return!1;var e=se(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Xo(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var i=e.styles[n]||{},s=e.attributes[n]||{},o=e.elements[n];!re(o)||!Te(o)||(Object.assign(o.style,i),Object.keys(s).forEach(function(r){var c=s[r];c===!1?o.removeAttribute(r):o.setAttribute(r,c===!0?"":c)}))})}function Zo(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(i){var s=e.elements[i],o=e.attributes[i]||{},r=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:n[i]),c=r.reduce(function(u,d){return u[d]="",u},{});!re(s)||!Te(s)||(Object.assign(s.style,c),Object.keys(o).forEach(function(u){s.removeAttribute(u)}))})}}const Wi={name:"applyStyles",enabled:!0,phase:"write",fn:Xo,effect:Zo,requires:["computeStyles"]};function Ae(t){return t.split("-")[0]}var ke=Math.max,Xt=Math.min,it=Math.round;function An(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Fi(){return!/^((?!chrome|android).)*safari/i.test(An())}function st(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var i=t.getBoundingClientRect(),s=1,o=1;e&&re(t)&&(s=t.offsetWidth>0&&it(i.width)/t.offsetWidth||1,o=t.offsetHeight>0&&it(i.height)/t.offsetHeight||1);var r=Ve(t)?se(t):window,c=r.visualViewport,u=!Fi()&&n,d=(i.left+(u&&c?c.offsetLeft:0))/s,a=(i.top+(u&&c?c.offsetTop:0))/o,l=i.width/s,m=i.height/o;return{width:l,height:m,top:a,right:d+l,bottom:a+m,left:d,x:d,y:a}}function Yn(t){var e=st(t),n=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:i}}function Xi(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&Gn(n)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function we(t){return se(t).getComputedStyle(t)}function Ko(t){return["table","td","th"].indexOf(Te(t))>=0}function Le(t){return((Ve(t)?t.ownerDocument:t.document)||window.document).documentElement}function Jt(t){return Te(t)==="html"?t:t.assignedSlot||t.parentNode||(Gn(t)?t.host:null)||Le(t)}function fi(t){return!re(t)||we(t).position==="fixed"?null:t.offsetParent}function zo(t){var e=/firefox/i.test(An()),n=/Trident/i.test(An());if(n&&re(t)){var i=we(t);if(i.position==="fixed")return null}var s=Jt(t);for(Gn(s)&&(s=s.host);re(s)&&["html","body"].indexOf(Te(s))<0;){var o=we(s);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return s;s=s.parentNode}return null}function _t(t){for(var e=se(t),n=fi(t);n&&Ko(n)&&we(n).position==="static";)n=fi(n);return n&&(Te(n)==="html"||Te(n)==="body"&&we(n).position==="static")?e:n||zo(t)||e}function Un(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function vt(t,e,n){return ke(t,Xt(e,n))}function qo(t,e,n){var i=vt(t,e,n);return i>n?n:i}function Zi(){return{top:0,right:0,bottom:0,left:0}}function Ki(t){return Object.assign({},Zi(),t)}function zi(t,e){return e.reduce(function(n,i){return n[i]=t,n},{})}var Jo=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,Ki(typeof e!="number"?e:zi(e,Ot))};function Qo(t){var e,n=t.state,i=t.name,s=t.options,o=n.elements.arrow,r=n.modifiersData.popperOffsets,c=Ae(n.placement),u=Un(c),d=[J,ce].indexOf(c)>=0,a=d?"height":"width";if(!(!o||!r)){var l=Jo(s.padding,n),m=Yn(o),p=u==="y"?q:J,v=u==="y"?ae:ce,y=n.rects.reference[a]+n.rects.reference[u]-r[u]-n.rects.popper[a],g=r[u]-n.rects.reference[u],R=_t(o),I=R?u==="y"?R.clientHeight||0:R.clientWidth||0:0,w=y/2-g/2,f=l[p],B=I-m[a]-l[v],T=I/2-m[a]/2+w,L=vt(f,T,B),G=u;n.modifiersData[i]=(e={},e[G]=L,e.centerOffset=L-T,e)}}function er(t){var e=t.state,n=t.options,i=n.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s=="string"&&(s=e.elements.popper.querySelector(s),!s)||Xi(e.elements.popper,s)&&(e.elements.arrow=s))}const tr={name:"arrow",enabled:!0,phase:"main",fn:Qo,effect:er,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ot(t){return t.split("-")[1]}var nr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ir(t,e){var n=t.x,i=t.y,s=e.devicePixelRatio||1;return{x:it(n*s)/s||0,y:it(i*s)/s||0}}function hi(t){var e,n=t.popper,i=t.popperRect,s=t.placement,o=t.variation,r=t.offsets,c=t.position,u=t.gpuAcceleration,d=t.adaptive,a=t.roundOffsets,l=t.isFixed,m=r.x,p=m===void 0?0:m,v=r.y,y=v===void 0?0:v,g=typeof a=="function"?a({x:p,y}):{x:p,y};p=g.x,y=g.y;var R=r.hasOwnProperty("x"),I=r.hasOwnProperty("y"),w=J,f=q,B=window;if(d){var T=_t(n),L="clientHeight",G="clientWidth";if(T===se(n)&&(T=Le(n),we(T).position!=="static"&&c==="absolute"&&(L="scrollHeight",G="scrollWidth")),T=T,s===q||(s===J||s===ce)&&o===At){f=ae;var H=l&&T===B&&B.visualViewport?B.visualViewport.height:T[L];y-=H-i.height,y*=u?1:-1}if(s===J||(s===q||s===ae)&&o===At){w=ce;var x=l&&T===B&&B.visualViewport?B.visualViewport.width:T[G];p-=x-i.width,p*=u?1:-1}}var Y=Object.assign({position:c},d&&nr),P=a===!0?ir({x:p,y},se(n)):{x:p,y};if(p=P.x,y=P.y,u){var M;return Object.assign({},Y,(M={},M[f]=I?"0":"",M[w]=R?"0":"",M.transform=(B.devicePixelRatio||1)<=1?"translate("+p+"px, "+y+"px)":"translate3d("+p+"px, "+y+"px, 0)",M))}return Object.assign({},Y,(e={},e[f]=I?y+"px":"",e[w]=R?p+"px":"",e.transform="",e))}function sr(t){var e=t.state,n=t.options,i=n.gpuAcceleration,s=i===void 0?!0:i,o=n.adaptive,r=o===void 0?!0:o,c=n.roundOffsets,u=c===void 0?!0:c,d={placement:Ae(e.placement),variation:ot(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:s,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,hi(Object.assign({},d,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:r,roundOffsets:u})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,hi(Object.assign({},d,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const or={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:sr,data:{}};var Yt={passive:!0};function rr(t){var e=t.state,n=t.instance,i=t.options,s=i.scroll,o=s===void 0?!0:s,r=i.resize,c=r===void 0?!0:r,u=se(e.elements.popper),d=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&d.forEach(function(a){a.addEventListener("scroll",n.update,Yt)}),c&&u.addEventListener("resize",n.update,Yt),function(){o&&d.forEach(function(a){a.removeEventListener("scroll",n.update,Yt)}),c&&u.removeEventListener("resize",n.update,Yt)}}const ar={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:rr,data:{}};var cr={left:"right",right:"left",bottom:"top",top:"bottom"};function Vt(t){return t.replace(/left|right|bottom|top/g,function(e){return cr[e]})}var ur={start:"end",end:"start"};function pi(t){return t.replace(/start|end/g,function(e){return ur[e]})}function kn(t){var e=se(t),n=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:n,scrollTop:i}}function $n(t){return st(Le(t)).left+kn(t).scrollLeft}function dr(t,e){var n=se(t),i=Le(t),s=n.visualViewport,o=i.clientWidth,r=i.clientHeight,c=0,u=0;if(s){o=s.width,r=s.height;var d=Fi();(d||!d&&e==="fixed")&&(c=s.offsetLeft,u=s.offsetTop)}return{width:o,height:r,x:c+$n(t),y:u}}function lr(t){var e,n=Le(t),i=kn(t),s=(e=t.ownerDocument)==null?void 0:e.body,o=ke(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),r=ke(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),c=-i.scrollLeft+$n(t),u=-i.scrollTop;return we(s||n).direction==="rtl"&&(c+=ke(n.clientWidth,s?s.clientWidth:0)-o),{width:o,height:r,x:c,y:u}}function Vn(t){var e=we(t),n=e.overflow,i=e.overflowX,s=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+i)}function qi(t){return["html","body","#document"].indexOf(Te(t))>=0?t.ownerDocument.body:re(t)&&Vn(t)?t:qi(Jt(t))}function Et(t,e){var n;e===void 0&&(e=[]);var i=qi(t),s=i===((n=t.ownerDocument)==null?void 0:n.body),o=se(i),r=s?[o].concat(o.visualViewport||[],Vn(i)?i:[]):i,c=e.concat(r);return s?c:c.concat(Et(Jt(r)))}function Tn(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function fr(t,e){var n=st(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function vi(t,e,n){return e===Vi?Tn(dr(t,n)):Ve(e)?fr(e,n):Tn(lr(Le(t)))}function hr(t){var e=Et(Jt(t)),n=["absolute","fixed"].indexOf(we(t).position)>=0,i=n&&re(t)?_t(t):t;return Ve(i)?e.filter(function(s){return Ve(s)&&Xi(s,i)&&Te(s)!=="body"}):[]}function pr(t,e,n,i){var s=e==="clippingParents"?hr(t):[].concat(e),o=[].concat(s,[n]),r=o[0],c=o.reduce(function(u,d){var a=vi(t,d,i);return u.top=ke(a.top,u.top),u.right=Xt(a.right,u.right),u.bottom=Xt(a.bottom,u.bottom),u.left=ke(a.left,u.left),u},vi(t,r,i));return c.width=c.right-c.left,c.height=c.bottom-c.top,c.x=c.left,c.y=c.top,c}function Ji(t){var e=t.reference,n=t.element,i=t.placement,s=i?Ae(i):null,o=i?ot(i):null,r=e.x+e.width/2-n.width/2,c=e.y+e.height/2-n.height/2,u;switch(s){case q:u={x:r,y:e.y-n.height};break;case ae:u={x:r,y:e.y+e.height};break;case ce:u={x:e.x+e.width,y:c};break;case J:u={x:e.x-n.width,y:c};break;default:u={x:e.x,y:e.y}}var d=s?Un(s):null;if(d!=null){var a=d==="y"?"height":"width";switch(o){case nt:u[d]=u[d]-(e[a]/2-n[a]/2);break;case At:u[d]=u[d]+(e[a]/2-n[a]/2);break}}return u}function Tt(t,e){e===void 0&&(e={});var n=e,i=n.placement,s=i===void 0?t.placement:i,o=n.strategy,r=o===void 0?t.strategy:o,c=n.boundary,u=c===void 0?xo:c,d=n.rootBoundary,a=d===void 0?Vi:d,l=n.elementContext,m=l===void 0?lt:l,p=n.altBoundary,v=p===void 0?!1:p,y=n.padding,g=y===void 0?0:y,R=Ki(typeof g!="number"?g:zi(g,Ot)),I=m===lt?Po:lt,w=t.rects.popper,f=t.elements[v?I:m],B=pr(Ve(f)?f:f.contextElement||Le(t.elements.popper),u,a,r),T=st(t.elements.reference),L=Ji({reference:T,element:w,strategy:"absolute",placement:s}),G=Tn(Object.assign({},w,L)),H=m===lt?G:T,x={top:B.top-H.top+R.top,bottom:H.bottom-B.bottom+R.bottom,left:B.left-H.left+R.left,right:H.right-B.right+R.right},Y=t.modifiersData.offset;if(m===lt&&Y){var P=Y[s];Object.keys(x).forEach(function(M){var Q=[ce,ae].indexOf(M)>=0?1:-1,ee=[q,ae].indexOf(M)>=0?"y":"x";x[M]+=P[ee]*Q})}return x}function vr(t,e){e===void 0&&(e={});var n=e,i=n.placement,s=n.boundary,o=n.rootBoundary,r=n.padding,c=n.flipVariations,u=n.allowedAutoPlacements,d=u===void 0?ji:u,a=ot(i),l=a?c?li:li.filter(function(v){return ot(v)===a}):Ot,m=l.filter(function(v){return d.indexOf(v)>=0});m.length===0&&(m=l);var p=m.reduce(function(v,y){return v[y]=Tt(t,{placement:y,boundary:s,rootBoundary:o,padding:r})[Ae(y)],v},{});return Object.keys(p).sort(function(v,y){return p[v]-p[y]})}function Er(t){if(Ae(t)===Hn)return[];var e=Vt(t);return[pi(t),e,pi(e)]}function mr(t){var e=t.state,n=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var s=n.mainAxis,o=s===void 0?!0:s,r=n.altAxis,c=r===void 0?!0:r,u=n.fallbackPlacements,d=n.padding,a=n.boundary,l=n.rootBoundary,m=n.altBoundary,p=n.flipVariations,v=p===void 0?!0:p,y=n.allowedAutoPlacements,g=e.options.placement,R=Ae(g),I=R===g,w=u||(I||!v?[Vt(g)]:Er(g)),f=[g].concat(w).reduce(function(Oe,ue){return Oe.concat(Ae(ue)===Hn?vr(e,{placement:ue,boundary:a,rootBoundary:l,padding:d,flipVariations:v,allowedAutoPlacements:y}):ue)},[]),B=e.rects.reference,T=e.rects.popper,L=new Map,G=!0,H=f[0],x=0;x<f.length;x++){var Y=f[x],P=Ae(Y),M=ot(Y)===nt,Q=[q,ae].indexOf(P)>=0,ee=Q?"width":"height",j=Tt(e,{placement:Y,boundary:a,rootBoundary:l,altBoundary:m,padding:d}),W=Q?M?ce:J:M?ae:q;B[ee]>T[ee]&&(W=Vt(W));var U=Vt(W),fe=[];if(o&&fe.push(j[P]<=0),c&&fe.push(j[W]<=0,j[U]<=0),fe.every(function(Oe){return Oe})){H=Y,G=!1;break}L.set(Y,fe)}if(G)for(var he=v?3:1,Me=function(ue){var _e=f.find(function(je){var Re=L.get(je);if(Re)return Re.slice(0,ue).every(function(We){return We})});if(_e)return H=_e,"break"},pe=he;pe>0;pe--){var De=Me(pe);if(De==="break")break}e.placement!==H&&(e.modifiersData[i]._skip=!0,e.placement=H,e.reset=!0)}}const yr={name:"flip",enabled:!0,phase:"main",fn:mr,requiresIfExists:["offset"],data:{_skip:!1}};function Ei(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function mi(t){return[q,ce,ae,J].some(function(e){return t[e]>=0})}function gr(t){var e=t.state,n=t.name,i=e.rects.reference,s=e.rects.popper,o=e.modifiersData.preventOverflow,r=Tt(e,{elementContext:"reference"}),c=Tt(e,{altBoundary:!0}),u=Ei(r,i),d=Ei(c,s,o),a=mi(u),l=mi(d);e.modifiersData[n]={referenceClippingOffsets:u,popperEscapeOffsets:d,isReferenceHidden:a,hasPopperEscaped:l},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":a,"data-popper-escaped":l})}const Ar={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:gr};function Tr(t,e,n){var i=Ae(t),s=[J,q].indexOf(i)>=0?-1:1,o=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,r=o[0],c=o[1];return r=r||0,c=(c||0)*s,[J,ce].indexOf(i)>=0?{x:c,y:r}:{x:r,y:c}}function Or(t){var e=t.state,n=t.options,i=t.name,s=n.offset,o=s===void 0?[0,0]:s,r=ji.reduce(function(a,l){return a[l]=Tr(l,e.rects,o),a},{}),c=r[e.placement],u=c.x,d=c.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=u,e.modifiersData.popperOffsets.y+=d),e.modifiersData[i]=r}const _r={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Or};function Rr(t){var e=t.state,n=t.name;e.modifiersData[n]=Ji({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Ir={name:"popperOffsets",enabled:!0,phase:"read",fn:Rr,data:{}};function wr(t){return t==="x"?"y":"x"}function Br(t){var e=t.state,n=t.options,i=t.name,s=n.mainAxis,o=s===void 0?!0:s,r=n.altAxis,c=r===void 0?!1:r,u=n.boundary,d=n.rootBoundary,a=n.altBoundary,l=n.padding,m=n.tether,p=m===void 0?!0:m,v=n.tetherOffset,y=v===void 0?0:v,g=Tt(e,{boundary:u,rootBoundary:d,padding:l,altBoundary:a}),R=Ae(e.placement),I=ot(e.placement),w=!I,f=Un(R),B=wr(f),T=e.modifiersData.popperOffsets,L=e.rects.reference,G=e.rects.popper,H=typeof y=="function"?y(Object.assign({},e.rects,{placement:e.placement})):y,x=typeof H=="number"?{mainAxis:H,altAxis:H}:Object.assign({mainAxis:0,altAxis:0},H),Y=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,P={x:0,y:0};if(T){if(o){var M,Q=f==="y"?q:J,ee=f==="y"?ae:ce,j=f==="y"?"height":"width",W=T[f],U=W+g[Q],fe=W-g[ee],he=p?-G[j]/2:0,Me=I===nt?L[j]:G[j],pe=I===nt?-G[j]:-L[j],De=e.elements.arrow,Oe=p&&De?Yn(De):{width:0,height:0},ue=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Zi(),_e=ue[Q],je=ue[ee],Re=vt(0,L[j],Oe[j]),We=w?L[j]/2-he-Re-_e-x.mainAxis:Me-Re-_e-x.mainAxis,Be=w?-L[j]/2+he+Re+je+x.mainAxis:pe+Re+je+x.mainAxis,Fe=e.elements.arrow&&_t(e.elements.arrow),It=Fe?f==="y"?Fe.clientTop||0:Fe.clientLeft||0:0,rt=(M=Y?.[f])!=null?M:0,wt=W+We-rt-It,Bt=W+Be-rt,at=vt(p?Xt(U,wt):U,W,p?ke(fe,Bt):fe);T[f]=at,P[f]=at-W}if(c){var ct,bt=f==="x"?q:J,Ct=f==="x"?ae:ce,Ie=T[B],be=B==="y"?"height":"width",ut=Ie+g[bt],xe=Ie-g[Ct],dt=[q,J].indexOf(R)!==-1,Nt=(ct=Y?.[B])!=null?ct:0,St=dt?ut:Ie-L[be]-G[be]-Nt+x.altAxis,Lt=dt?Ie+L[be]+G[be]-Nt-x.altAxis:xe,Mt=p&&dt?qo(St,Ie,Lt):vt(p?St:ut,Ie,p?Lt:xe);T[B]=Mt,P[B]=Mt-Ie}e.modifiersData[i]=P}}const br={name:"preventOverflow",enabled:!0,phase:"main",fn:Br,requiresIfExists:["offset"]};function Cr(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Nr(t){return t===se(t)||!re(t)?kn(t):Cr(t)}function Sr(t){var e=t.getBoundingClientRect(),n=it(e.width)/t.offsetWidth||1,i=it(e.height)/t.offsetHeight||1;return n!==1||i!==1}function Lr(t,e,n){n===void 0&&(n=!1);var i=re(e),s=re(e)&&Sr(e),o=Le(e),r=st(t,s,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(i||!i&&!n)&&((Te(e)!=="body"||Vn(o))&&(c=Nr(e)),re(e)?(u=st(e,!0),u.x+=e.clientLeft,u.y+=e.clientTop):o&&(u.x=$n(o))),{x:r.left+c.scrollLeft-u.x,y:r.top+c.scrollTop-u.y,width:r.width,height:r.height}}function Mr(t){var e=new Map,n=new Set,i=[];t.forEach(function(o){e.set(o.name,o)});function s(o){n.add(o.name);var r=[].concat(o.requires||[],o.requiresIfExists||[]);r.forEach(function(c){if(!n.has(c)){var u=e.get(c);u&&s(u)}}),i.push(o)}return t.forEach(function(o){n.has(o.name)||s(o)}),i}function Dr(t){var e=Mr(t);return Fo.reduce(function(n,i){return n.concat(e.filter(function(s){return s.phase===i}))},[])}function xr(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function Pr(t){var e=t.reduce(function(n,i){var s=n[i.name];return n[i.name]=s?Object.assign({},s,i,{options:Object.assign({},s.options,i.options),data:Object.assign({},s.data,i.data)}):i,n},{});return Object.keys(e).map(function(n){return e[n]})}var yi={placement:"bottom",modifiers:[],strategy:"absolute"};function gi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Hr(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,i=n===void 0?[]:n,s=e.defaultOptions,o=s===void 0?yi:s;return function(c,u,d){d===void 0&&(d=o);var a={placement:"bottom",orderedModifiers:[],options:Object.assign({},yi,o),modifiersData:{},elements:{reference:c,popper:u},attributes:{},styles:{}},l=[],m=!1,p={state:a,setOptions:function(R){var I=typeof R=="function"?R(a.options):R;y(),a.options=Object.assign({},o,a.options,I),a.scrollParents={reference:Ve(c)?Et(c):c.contextElement?Et(c.contextElement):[],popper:Et(u)};var w=Dr(Pr([].concat(i,a.options.modifiers)));return a.orderedModifiers=w.filter(function(f){return f.enabled}),v(),p.update()},forceUpdate:function(){if(!m){var R=a.elements,I=R.reference,w=R.popper;if(gi(I,w)){a.rects={reference:Lr(I,_t(w),a.options.strategy==="fixed"),popper:Yn(w)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach(function(x){return a.modifiersData[x.name]=Object.assign({},x.data)});for(var f=0;f<a.orderedModifiers.length;f++){if(a.reset===!0){a.reset=!1,f=-1;continue}var B=a.orderedModifiers[f],T=B.fn,L=B.options,G=L===void 0?{}:L,H=B.name;typeof T=="function"&&(a=T({state:a,options:G,name:H,instance:p})||a)}}}},update:xr(function(){return new Promise(function(g){p.forceUpdate(),g(a)})}),destroy:function(){y(),m=!0}};if(!gi(c,u))return p;p.setOptions(d).then(function(g){!m&&d.onFirstUpdate&&d.onFirstUpdate(g)});function v(){a.orderedModifiers.forEach(function(g){var R=g.name,I=g.options,w=I===void 0?{}:I,f=g.effect;if(typeof f=="function"){var B=f({state:a,name:R,instance:p,options:w}),T=function(){};l.push(B||T)}})}function y(){l.forEach(function(g){return g()}),l=[]}return p}}var Gr=[ar,Ir,or,Wi,_r,yr,br,tr,Ar],Yr=Hr({defaultModifiers:Gr}),Ur="tippy-box",Qi="tippy-content",kr="tippy-backdrop",es="tippy-arrow",ts="tippy-svg-arrow",Ge={passive:!0,capture:!0},ns=function(){return document.body};function dn(t,e,n){if(Array.isArray(t)){var i=t[e];return i??(Array.isArray(n)?n[e]:n)}return t}function jn(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function is(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Ai(t,e){if(e===0)return t;var n;return function(i){clearTimeout(n),n=setTimeout(function(){t(i)},e)}}function $r(t){return t.split(/\s+/).filter(Boolean)}function Qe(t){return[].concat(t)}function Ti(t,e){t.indexOf(e)===-1&&t.push(e)}function Vr(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function jr(t){return t.split("-")[0]}function Zt(t){return[].slice.call(t)}function Oi(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function mt(){return document.createElement("div")}function Qt(t){return["Element","Fragment"].some(function(e){return jn(t,e)})}function Wr(t){return jn(t,"NodeList")}function Fr(t){return jn(t,"MouseEvent")}function Xr(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function Zr(t){return Qt(t)?[t]:Wr(t)?Zt(t):Array.isArray(t)?t:Zt(document.querySelectorAll(t))}function ln(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function _i(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function Kr(t){var e,n=Qe(t),i=n[0];return i!=null&&(e=i.ownerDocument)!=null&&e.body?i.ownerDocument:document}function zr(t,e){var n=e.clientX,i=e.clientY;return t.every(function(s){var o=s.popperRect,r=s.popperState,c=s.props,u=c.interactiveBorder,d=jr(r.placement),a=r.modifiersData.offset;if(!a)return!0;var l=d==="bottom"?a.top.y:0,m=d==="top"?a.bottom.y:0,p=d==="right"?a.left.x:0,v=d==="left"?a.right.x:0,y=o.top-i+l>u,g=i-o.bottom-m>u,R=o.left-n+p>u,I=n-o.right-v>u;return y||g||R||I})}function fn(t,e,n){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(s){t[i](s,n)})}function Ri(t,e){for(var n=e;n;){var i;if(t.contains(n))return!0;n=n.getRootNode==null||(i=n.getRootNode())==null?void 0:i.host}return!1}var ye={isTouch:!1},Ii=0;function qr(){ye.isTouch||(ye.isTouch=!0,window.performance&&document.addEventListener("mousemove",ss))}function ss(){var t=performance.now();t-Ii<20&&(ye.isTouch=!1,document.removeEventListener("mousemove",ss)),Ii=t}function Jr(){var t=document.activeElement;if(Xr(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Qr(){document.addEventListener("touchstart",qr,Ge),window.addEventListener("blur",Jr)}var ea=typeof window<"u"&&typeof document<"u",ta=ea?!!window.msCrypto:!1,na={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ia={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},le=Object.assign({appendTo:ns,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},na,ia),sa=Object.keys(le),oa=function(e){var n=Object.keys(e);n.forEach(function(i){le[i]=e[i]})};function os(t){var e=t.plugins||[],n=e.reduce(function(i,s){var o=s.name,r=s.defaultValue;if(o){var c;i[o]=t[o]!==void 0?t[o]:(c=le[o])!=null?c:r}return i},{});return Object.assign({},t,n)}function ra(t,e){var n=e?Object.keys(os(Object.assign({},le,{plugins:e}))):sa,i=n.reduce(function(s,o){var r=(t.getAttribute("data-tippy-"+o)||"").trim();if(!r)return s;if(o==="content")s[o]=r;else try{s[o]=JSON.parse(r)}catch{s[o]=r}return s},{});return i}function wi(t,e){var n=Object.assign({},e,{content:is(e.content,[t])},e.ignoreAttributes?{}:ra(t,e.plugins));return n.aria=Object.assign({},le.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var aa=function(){return"innerHTML"};function On(t,e){t[aa()]=e}function Bi(t){var e=mt();return t===!0?e.className=es:(e.className=ts,Qt(t)?e.appendChild(t):On(e,t)),e}function bi(t,e){Qt(e.content)?(On(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?On(t,e.content):t.textContent=e.content)}function _n(t){var e=t.firstElementChild,n=Zt(e.children);return{box:e,content:n.find(function(i){return i.classList.contains(Qi)}),arrow:n.find(function(i){return i.classList.contains(es)||i.classList.contains(ts)}),backdrop:n.find(function(i){return i.classList.contains(kr)})}}function rs(t){var e=mt(),n=mt();n.className=Ur,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=mt();i.className=Qi,i.setAttribute("data-state","hidden"),bi(i,t.props),e.appendChild(n),n.appendChild(i),s(t.props,t.props);function s(o,r){var c=_n(e),u=c.box,d=c.content,a=c.arrow;r.theme?u.setAttribute("data-theme",r.theme):u.removeAttribute("data-theme"),typeof r.animation=="string"?u.setAttribute("data-animation",r.animation):u.removeAttribute("data-animation"),r.inertia?u.setAttribute("data-inertia",""):u.removeAttribute("data-inertia"),u.style.maxWidth=typeof r.maxWidth=="number"?r.maxWidth+"px":r.maxWidth,r.role?u.setAttribute("role",r.role):u.removeAttribute("role"),(o.content!==r.content||o.allowHTML!==r.allowHTML)&&bi(d,t.props),r.arrow?a?o.arrow!==r.arrow&&(u.removeChild(a),u.appendChild(Bi(r.arrow))):u.appendChild(Bi(r.arrow)):a&&u.removeChild(a)}return{popper:e,onUpdate:s}}rs.$$tippy=!0;var ca=1,Ut=[],hn=[];function ua(t,e){var n=wi(t,Object.assign({},le,os(Oi(e)))),i,s,o,r=!1,c=!1,u=!1,d=!1,a,l,m,p=[],v=Ai(wt,n.interactiveDebounce),y,g=ca++,R=null,I=Vr(n.plugins),w={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},f={id:g,reference:t,popper:mt(),popperInstance:R,props:n,state:w,plugins:I,clearDelayTimeouts:St,setProps:Lt,setContent:Mt,show:cs,hide:us,hideWithInteractivity:ds,enable:dt,disable:Nt,unmount:ls,destroy:fs};if(!n.render)return f;var B=n.render(f),T=B.popper,L=B.onUpdate;T.setAttribute("data-tippy-root",""),T.id="tippy-"+f.id,f.popper=T,t._tippy=f,T._tippy=f;var G=I.map(function(h){return h.fn(f)}),H=t.hasAttribute("aria-expanded");return Fe(),he(),W(),U("onCreate",[f]),n.showOnCreate&&ut(),T.addEventListener("mouseenter",function(){f.props.interactive&&f.state.isVisible&&f.clearDelayTimeouts()}),T.addEventListener("mouseleave",function(){f.props.interactive&&f.props.trigger.indexOf("mouseenter")>=0&&Q().addEventListener("mousemove",v)}),f;function x(){var h=f.props.touch;return Array.isArray(h)?h:[h,0]}function Y(){return x()[0]==="hold"}function P(){var h;return!!((h=f.props.render)!=null&&h.$$tippy)}function M(){return y||t}function Q(){var h=M().parentNode;return h?Kr(h):document}function ee(){return _n(T)}function j(h){return f.state.isMounted&&!f.state.isVisible||ye.isTouch||a&&a.type==="focus"?0:dn(f.props.delay,h?0:1,le.delay)}function W(h){h===void 0&&(h=!1),T.style.pointerEvents=f.props.interactive&&!h?"":"none",T.style.zIndex=""+f.props.zIndex}function U(h,A,_){if(_===void 0&&(_=!0),G.forEach(function(b){b[h]&&b[h].apply(b,A)}),_){var N;(N=f.props)[h].apply(N,A)}}function fe(){var h=f.props.aria;if(h.content){var A="aria-"+h.content,_=T.id,N=Qe(f.props.triggerTarget||t);N.forEach(function(b){var X=b.getAttribute(A);if(f.state.isVisible)b.setAttribute(A,X?X+" "+_:_);else{var oe=X&&X.replace(_,"").trim();oe?b.setAttribute(A,oe):b.removeAttribute(A)}})}}function he(){if(!(H||!f.props.aria.expanded)){var h=Qe(f.props.triggerTarget||t);h.forEach(function(A){f.props.interactive?A.setAttribute("aria-expanded",f.state.isVisible&&A===M()?"true":"false"):A.removeAttribute("aria-expanded")})}}function Me(){Q().removeEventListener("mousemove",v),Ut=Ut.filter(function(h){return h!==v})}function pe(h){if(!(ye.isTouch&&(u||h.type==="mousedown"))){var A=h.composedPath&&h.composedPath()[0]||h.target;if(!(f.props.interactive&&Ri(T,A))){if(Qe(f.props.triggerTarget||t).some(function(_){return Ri(_,A)})){if(ye.isTouch||f.state.isVisible&&f.props.trigger.indexOf("click")>=0)return}else U("onClickOutside",[f,h]);f.props.hideOnClick===!0&&(f.clearDelayTimeouts(),f.hide(),c=!0,setTimeout(function(){c=!1}),f.state.isMounted||_e())}}}function De(){u=!0}function Oe(){u=!1}function ue(){var h=Q();h.addEventListener("mousedown",pe,!0),h.addEventListener("touchend",pe,Ge),h.addEventListener("touchstart",Oe,Ge),h.addEventListener("touchmove",De,Ge)}function _e(){var h=Q();h.removeEventListener("mousedown",pe,!0),h.removeEventListener("touchend",pe,Ge),h.removeEventListener("touchstart",Oe,Ge),h.removeEventListener("touchmove",De,Ge)}function je(h,A){We(h,function(){!f.state.isVisible&&T.parentNode&&T.parentNode.contains(T)&&A()})}function Re(h,A){We(h,A)}function We(h,A){var _=ee().box;function N(b){b.target===_&&(fn(_,"remove",N),A())}if(h===0)return A();fn(_,"remove",l),fn(_,"add",N),l=N}function Be(h,A,_){_===void 0&&(_=!1);var N=Qe(f.props.triggerTarget||t);N.forEach(function(b){b.addEventListener(h,A,_),p.push({node:b,eventType:h,handler:A,options:_})})}function Fe(){Y()&&(Be("touchstart",rt,{passive:!0}),Be("touchend",Bt,{passive:!0})),$r(f.props.trigger).forEach(function(h){if(h!=="manual")switch(Be(h,rt),h){case"mouseenter":Be("mouseleave",Bt);break;case"focus":Be(ta?"focusout":"blur",at);break;case"focusin":Be("focusout",at);break}})}function It(){p.forEach(function(h){var A=h.node,_=h.eventType,N=h.handler,b=h.options;A.removeEventListener(_,N,b)}),p=[]}function rt(h){var A,_=!1;if(!(!f.state.isEnabled||ct(h)||c)){var N=((A=a)==null?void 0:A.type)==="focus";a=h,y=h.currentTarget,he(),!f.state.isVisible&&Fr(h)&&Ut.forEach(function(b){return b(h)}),h.type==="click"&&(f.props.trigger.indexOf("mouseenter")<0||r)&&f.props.hideOnClick!==!1&&f.state.isVisible?_=!0:ut(h),h.type==="click"&&(r=!_),_&&!N&&xe(h)}}function wt(h){var A=h.target,_=M().contains(A)||T.contains(A);if(!(h.type==="mousemove"&&_)){var N=be().concat(T).map(function(b){var X,oe=b._tippy,Xe=(X=oe.popperInstance)==null?void 0:X.state;return Xe?{popperRect:b.getBoundingClientRect(),popperState:Xe,props:n}:null}).filter(Boolean);zr(N,h)&&(Me(),xe(h))}}function Bt(h){var A=ct(h)||f.props.trigger.indexOf("click")>=0&&r;if(!A){if(f.props.interactive){f.hideWithInteractivity(h);return}xe(h)}}function at(h){f.props.trigger.indexOf("focusin")<0&&h.target!==M()||f.props.interactive&&h.relatedTarget&&T.contains(h.relatedTarget)||xe(h)}function ct(h){return ye.isTouch?Y()!==h.type.indexOf("touch")>=0:!1}function bt(){Ct();var h=f.props,A=h.popperOptions,_=h.placement,N=h.offset,b=h.getReferenceClientRect,X=h.moveTransition,oe=P()?_n(T).arrow:null,Xe=b?{getBoundingClientRect:b,contextElement:b.contextElement||M()}:t,Wn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Dt){var Ze=Dt.state;if(P()){var hs=ee(),tn=hs.box;["placement","reference-hidden","escaped"].forEach(function(xt){xt==="placement"?tn.setAttribute("data-placement",Ze.placement):Ze.attributes.popper["data-popper-"+xt]?tn.setAttribute("data-"+xt,""):tn.removeAttribute("data-"+xt)}),Ze.attributes.popper={}}}},Pe=[{name:"offset",options:{offset:N}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!X}},Wn];P()&&oe&&Pe.push({name:"arrow",options:{element:oe,padding:3}}),Pe.push.apply(Pe,A?.modifiers||[]),f.popperInstance=Yr(Xe,T,Object.assign({},A,{placement:_,onFirstUpdate:m,modifiers:Pe}))}function Ct(){f.popperInstance&&(f.popperInstance.destroy(),f.popperInstance=null)}function Ie(){var h=f.props.appendTo,A,_=M();f.props.interactive&&h===ns||h==="parent"?A=_.parentNode:A=is(h,[_]),A.contains(T)||A.appendChild(T),f.state.isMounted=!0,bt()}function be(){return Zt(T.querySelectorAll("[data-tippy-root]"))}function ut(h){f.clearDelayTimeouts(),h&&U("onTrigger",[f,h]),ue();var A=j(!0),_=x(),N=_[0],b=_[1];ye.isTouch&&N==="hold"&&b&&(A=b),A?i=setTimeout(function(){f.show()},A):f.show()}function xe(h){if(f.clearDelayTimeouts(),U("onUntrigger",[f,h]),!f.state.isVisible){_e();return}if(!(f.props.trigger.indexOf("mouseenter")>=0&&f.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(h.type)>=0&&r)){var A=j(!1);A?s=setTimeout(function(){f.state.isVisible&&f.hide()},A):o=requestAnimationFrame(function(){f.hide()})}}function dt(){f.state.isEnabled=!0}function Nt(){f.hide(),f.state.isEnabled=!1}function St(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(o)}function Lt(h){if(!f.state.isDestroyed){U("onBeforeUpdate",[f,h]),It();var A=f.props,_=wi(t,Object.assign({},A,Oi(h),{ignoreAttributes:!0}));f.props=_,Fe(),A.interactiveDebounce!==_.interactiveDebounce&&(Me(),v=Ai(wt,_.interactiveDebounce)),A.triggerTarget&&!_.triggerTarget?Qe(A.triggerTarget).forEach(function(N){N.removeAttribute("aria-expanded")}):_.triggerTarget&&t.removeAttribute("aria-expanded"),he(),W(),L&&L(A,_),f.popperInstance&&(bt(),be().forEach(function(N){requestAnimationFrame(N._tippy.popperInstance.forceUpdate)})),U("onAfterUpdate",[f,h])}}function Mt(h){f.setProps({content:h})}function cs(){var h=f.state.isVisible,A=f.state.isDestroyed,_=!f.state.isEnabled,N=ye.isTouch&&!f.props.touch,b=dn(f.props.duration,0,le.duration);if(!(h||A||_||N)&&!M().hasAttribute("disabled")&&(U("onShow",[f],!1),f.props.onShow(f)!==!1)){if(f.state.isVisible=!0,P()&&(T.style.visibility="visible"),W(),ue(),f.state.isMounted||(T.style.transition="none"),P()){var X=ee(),oe=X.box,Xe=X.content;ln([oe,Xe],0)}m=function(){var Pe;if(!(!f.state.isVisible||d)){if(d=!0,T.offsetHeight,T.style.transition=f.props.moveTransition,P()&&f.props.animation){var en=ee(),Dt=en.box,Ze=en.content;ln([Dt,Ze],b),_i([Dt,Ze],"visible")}fe(),he(),Ti(hn,f),(Pe=f.popperInstance)==null||Pe.forceUpdate(),U("onMount",[f]),f.props.animation&&P()&&Re(b,function(){f.state.isShown=!0,U("onShown",[f])})}},Ie()}}function us(){var h=!f.state.isVisible,A=f.state.isDestroyed,_=!f.state.isEnabled,N=dn(f.props.duration,1,le.duration);if(!(h||A||_)&&(U("onHide",[f],!1),f.props.onHide(f)!==!1)){if(f.state.isVisible=!1,f.state.isShown=!1,d=!1,r=!1,P()&&(T.style.visibility="hidden"),Me(),_e(),W(!0),P()){var b=ee(),X=b.box,oe=b.content;f.props.animation&&(ln([X,oe],N),_i([X,oe],"hidden"))}fe(),he(),f.props.animation?P()&&je(N,f.unmount):f.unmount()}}function ds(h){Q().addEventListener("mousemove",v),Ti(Ut,v),v(h)}function ls(){f.state.isVisible&&f.hide(),f.state.isMounted&&(Ct(),be().forEach(function(h){h._tippy.unmount()}),T.parentNode&&T.parentNode.removeChild(T),hn=hn.filter(function(h){return h!==f}),f.state.isMounted=!1,U("onHidden",[f]))}function fs(){f.state.isDestroyed||(f.clearDelayTimeouts(),f.unmount(),It(),delete t._tippy,f.state.isDestroyed=!0,U("onDestroy",[f]))}}function Rt(t,e){e===void 0&&(e={});var n=le.plugins.concat(e.plugins||[]);Qr();var i=Object.assign({},e,{plugins:n}),s=Zr(t),o=s.reduce(function(r,c){var u=c&&ua(c,i);return u&&r.push(u),r},[]);return Qt(t)?o[0]:o}Rt.defaultProps=le;Rt.setDefaultProps=oa;Rt.currentInput=ye;Object.assign({},Wi,{effect:function(e){var n=e.state,i={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,i.popper),n.styles=i,n.elements.arrow&&Object.assign(n.elements.arrow.style,i.arrow)}});Rt.setDefaultProps({render:rs});function da(t,e){const n=document.getElementById(`${t}`);n&&Rt(n,{content:e,theme:"battlesystem"})}class la{appWindow;constructor(){this.appWindow=document.getElementById("app")}async Initialize(){this.appWindow=document.getElementById("app"),$.playerRole==="GM"?(this.appWindow.innerHTML=C.MAINHTML,$.sceneReady&&await $.UpdateZIndex($.sceneItems),me(E.DISABLEBIND,Ue(te.DISABLEBIND)),me(E.KEEPATTACH,Ue(te.KEEPATTACH)),me(E.MAPLAYER,Ce(E.MAPLAYER)),me(E.DRAWINGLAYER,Ce(E.DRAWINGLAYER)),me(E.PROPLAYER,Ce(E.PROPLAYER)),me(E.MOUNTLAYER,Ce(E.MOUNTLAYER)),me(E.CHARACTERLAYER,Ce(E.CHARACTERLAYER)),me(E.ATTACHLAYER,Ce(E.ATTACHLAYER)),me(E.NOTELAYER,Ce(E.NOTELAYER)),me(E.TEXTLAYER,Ce(E.TEXTLAYER)),this.CreateTooltips()):(this.appWindow.innerHTML='<div id="playerView">Configuration is GM only.<div id="patreonContainer"></div></div>',await O.action.setHeight(50)),document.getElementById("patreonContainer").appendChild(Do()),await xn(),await $i(),await Pn()}CreateTooltips(){const e=new Map;e.set("tip_removebind","Removes the button for players that allows binding tokens together."),e.set("tip_attachparent","Makes it so attachments stay with the parent token when Flipping between tokens."),e.set("tip_zindex","Controls which layers the auto Z-Indexing is active on."),e.forEach((n,i)=>{da(i,n)})}}const as=new la;O.onReady(async()=>{if(await O.scene.isReady()===!1){const e=O.scene.onReadyChange(async n=>{n&&(e(),await Ci())})}else await Ci()});async function Ci(){await $.InitializeCache(),$.SetupHandlers(),await as.Initialize(),await xn(),await $i(),await Pn()}
